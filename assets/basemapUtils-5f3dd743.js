import{s as u,x as c}from"./Basemap-6b9a90ce.js";import{s as L,b as o}from"./Error-781981d1.js";import{j as S}from"./Collection-912f4315.js";import{t as s,r as n}from"./typedArrayUtil-74bbfd45.js";import{K as g}from"./request-b4e08038.js";import{b as R}from"./ensureType-125d327f.js";const f=L.getLogger("esri.support.basemapUtils");function A(){return{}}function K(e){for(const a in e){const t=e[a];(t==null?void 0:t.destroyed)===!1&&t.destroy(),delete e[a]}}function C(e,a){let t;if(typeof e=="string"){if(!(e in u)){const r=Object.entries(u).filter(([l,i])=>o.apiKey&&!i.classic||!o.apiKey&&i.classic&&!i.deprecated).map(([l])=>`"${l}"`).join(", ");return f.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}a&&(t=a[e]),t||(t=c.fromId(e),a&&(a[e]=t))}else t=R(c,e);return t!=null&&t.destroyed&&(f.warn("The provided basemap is already destroyed",{basemap:t}),t=null),t}function B(e,a){return e===a?!0:$(p(e),p(a),{mustMatchReferences:!0})==="equal"}function G(e,a){var i;if(s(a)||s(e))return{spatialReference:null,updating:!1};if(a.loadStatus==="not-loaded")return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(a.baseLayers.length===0)return{spatialReference:null,updating:!1};const t=a.baseLayers.getItemAt(0);switch(t.loadStatus){case"not-loaded":t.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in t?t.supportedSpatialReferences:null)||["tileInfo"in t?(i=t.tileInfo)==null?void 0:i.spatialReference:t.spatialReference]).filter(Boolean),l=e.spatialReference;return l?{spatialReference:r.find(v=>l.equals(v))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}function p(e){return e?!e.loaded&&e.resourceInfo?x(e.resourceInfo.data):{baseLayers:y(e.baseLayers),referenceLayers:y(e.referenceLayers)}:null}function y(e){return(S.isCollection(e)?e.toArray():e).map(h)}function h(e){var a,t;return{type:e.type,url:b("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!n(e.sublayers)||(a=e.sublayers)==null?void 0:a.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(t=e.activeLayer)==null?void 0:t.id:void 0}}function x(e){return e?{baseLayers:d((e.baseMapLayers??[]).filter(a=>!a.isReference)),referenceLayers:d((e.baseMapLayers??[]).filter(a=>a.isReference))}:null}function d(e){return e.map(a=>I(a))}function I(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;default:a="unknown"}return{type:a,url:b(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale!=null?e.minScale:0,maxScale:e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function $(e,a,t){return e!=null!=(a!=null)?"not-equal":!e||!a?"equal":m(e.baseLayers,a.baseLayers)?m(e.referenceLayers,a.referenceLayers)?"equal":t.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function m(e,a){if(e.length!==a.length)return!1;for(let t=0;t<e.length;t++)if(!q(e[t],a[t]))return!1;return!0}function q(e,a){if(e.type!==a.type||e.type==="scene"||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity)return!1;if(n(e.activeLayerId)||n(a.activeLayerId))return e.activeLayerId===a.activeLayerId;if(n(e.sublayers)||n(a.sublayers)){if(s(e.sublayers)||s(a.sublayers)||e.sublayers.length!==a.sublayers.length)return!1;for(let t=0;t<e.sublayers.length;t++){const r=e.sublayers.at(t),l=a.sublayers.at(t);if((r==null?void 0:r.id)!==(l==null?void 0:l.id)||(r==null?void 0:r.visible)!==(l==null?void 0:l.visible))return!1}}return!0}function b(e){return e?g(e).replace(/^\s*https?:/i,"").toLowerCase():""}export{B as L,G as h,C as m,A as p,K as y};
