import{l as z}from"./Color-9f46ece8.js";import{a as P}from"./Error-d97df89f.js";import{n as A}from"./fontUtils-95b845d3.js";import{u as v,e as B}from"./screenUtils-7afeb41c.js";import{f as D,y as T,h as R}from"./utils-e0744d8b.js";import{t as x,h as U,i as $,l as V}from"./index-738baf21.js";import"./colorUtils-639f4d25.js";import"./mathUtils-b3bee9e7.js";import"./typedArrayUtil-96f93e5b.js";import"./ensureType-348c3d61.js";import"./string-feb899cf.js";import"./preload-helper-f8378b50.js";import"./symbols-946d4e11.js";import"./JSONSupport-ed372989.js";import"./nextTick-3ee5a785.js";import"./promiseUtils-ac1bd36f.js";import"./CIMSymbol-0fa077f5.js";import"./enumeration-49e09bda.js";import"./cast-73cfc253.js";import"./Extent-fd3ac910.js";import"./fieldUtils-66be74eb.js";import"./geometry-d89d4a34.js";import"./Polyline-9d44200b.js";import"./typeUtils-2ccaf90d.js";import"./opacityUtils-cc413a8c.js";import"./symbolLayerUtils3D-0c6ed99a.js";import"./aaBoundingBox-1eda6d1b.js";import"./request-7c0a9d4c.js";import"./persistableUrlUtils-26091271.js";import"./Collection-d9d92883.js";import"./Evented-e2ee9722.js";import"./SimpleObservable-04055e8d.js";import"./collectionUtils-e98ed3f0.js";import"./Portal-172924b2.js";import"./Loadable-c96deb83.js";import"./Promise-34cff6d6.js";import"./locale-30120714.js";import"./PortalGroup-751b527f.js";import"./PortalUser-7f979a04.js";import"./Clonable-5318ec31.js";import"./asyncUtils-f0fdc8c7.js";import"./BlendLayer-5cec7349.js";import"./parser-a11e786f.js";import"./mat4f32-60a2394b.js";import"./mat4-1ee69bd5.js";import"./assets-2c955bed.js";import"./ItemCache-d06df2a7.js";import"./MemCache-7d4aa654.js";import"./utils-1aab1134.js";import"./Basemap-1b908f31.js";import"./deprecate-424c57c7.js";import"./loadAll-f0d5998c.js";import"./PortalItem-a25335a3.js";import"./messages-226fbb40.js";import"./writeUtils-5c3c75bd.js";import"./layerUtils-a0871894.js";import"./compilerUtils-8d4f8499.js";import"./CollectionFlattener-52a0c7e4.js";import"./TablesMixin-1e04401c.js";import"./Layer-07a07202.js";import"./Identifiable-876da2a8.js";import"./Graphic-f117754c.js";import"./PopupTemplate-63dce4d3.js";import"./number-205e28e0.js";import"./jsonUtils-dd0891e0.js";import"./Cyclical-0205ad3e.js";import"./reactiveUtils-307e98f9.js";import"./workers-4f8dfa2f.js";import"./Connection-5e453cc1.js";import"./Queue-c92bc561.js";import"./intl-7c488bb0.js";import"./projection-d7a5b449.js";import"./zscale-e06cee6f.js";import"./TileInfo-e107254e.js";import"./aaBoundingRect-a7e9efee.js";import"./widget-945f9e61.js";import"./uuid-73213768.js";import"./HandleOwner-4c8d824c.js";import"./byteSizeEstimations-90c5a50d.js";import"./AttachmentInfo-9750c730.js";import"./AttachmentQuery-c89a8ac2.js";import"./LegendOptions-8200d5f5.js";import"./jsonUtils-37cc07d7.js";import"./UniqueValueRenderer-b6a7d586.js";import"./diffUtils-ac6d6369.js";import"./colorRamps-fff34da2.js";import"./sizeVariableUtils-d4870b0d.js";import"./visualVariableUtils-6f05f98d.js";import"./lengthUtils-bc8879ed.js";import"./jsonUtils-7442f08f.js";import"./styleUtils-1d3bc535.js";import"./DictionaryLoader-0dadb1e0.js";import"./LRUCache-9c365b2a.js";import"./heatmapUtils-16ee21b5.js";import"./vec4f64-aa64c7e9.js";import"./DataLayerSource-71059dc4.js";import"./Field-b17a677d.js";import"./fieldType-b21f2e7f.js";import"./executeForIds-0c62bbcf.js";import"./utils-ada6b2ec.js";import"./query-eac603fe.js";import"./normalizeUtils-9dc1c489.js";import"./normalizeUtilsCommon-155f1aa2.js";import"./urlUtils-6a004888.js";import"./pbfQueryUtils-bad736cf.js";import"./pbf-3634de4f.js";import"./OptimizedFeature-7af17710.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./queryZScale-a0b71b11.js";import"./FeatureSet-00b7d51e.js";import"./Query-bf719160.js";import"./TimeExtent-d2d7594c.js";import"./featureConversionUtils-00c47b2e.js";import"./RelationshipQuery-a13e27d1.js";import"./TopFeaturesQuery-5bb7c994.js";import"./FeatureLayer-42e1678e.js";import"./MultiOriginJSONSupport-97bf66dd.js";import"./serviceCapabilitiesUtils-02cebe9b.js";import"./arcgisLayerUrl-9d6ab56c.js";import"./FeatureLayerBase-de1a166f.js";import"./HeightModelInfo-bad6650e.js";import"./OperationalLayer-a420b681.js";import"./ElevationInfo-75e7bf35.js";import"./TimeReference-b6332926.js";import"./datetime-b6333958.js";import"./editsZScale-b954eebc.js";import"./APIKeyMixin-b93c2049.js";import"./ArcGISService-cca20289.js";import"./CustomParametersMixin-01a04769.js";import"./EditBusLayer-984da402.js";import"./FeatureReductionLayer-fd41123b.js";import"./labelingInfo-f7d1c159.js";import"./labelUtils-6965a8ca.js";import"./defaultsJSON-b087dd4d.js";import"./OrderedLayer-9cb8835d.js";import"./PortalLayer-d54f6a39.js";import"./portalItemUtils-72345980.js";import"./RefreshableLayer-672ecb56.js";import"./ScaleRangeLayer-24099455.js";import"./TemporalLayer-c479c738.js";import"./FeatureTemplate-1fd8fac4.js";import"./FeatureType-b736019f.js";import"./fieldProperties-1fb52610.js";import"./FieldsIndex-7c963fe9.js";import"./versionUtils-aabb6832.js";import"./styleUtils-f45b991d.js";import"./popupUtils-3d5141e6.js";import"./colorUtils-c0f43caf.js";import"./mat2d-94b8f776.js";import"./webStyleSymbolUtils-54e19231.js";import"./devEnvironmentUtils-5002a058.js";import"./Scheduler-72fecd6f.js";import"./GraphicsCollection-89010fd9.js";import"./ViewingMode-915d19cb.js";import"./unitBezier-881ac1eb.js";import"./vec2-9030ffc5.js";import"./vec2f64-22afc56f.js";import"./mat3-d3027213.js";import"./mat3f32-6c416b1c.js";import"./vec2f32-eaf29605.js";import"./TileStrategy-0607ccca.js";import"./TileStore-56391591.js";import"./TileKey-555f347f.js";import"./rbush-f2a85c98.js";import"./quickselect-56c5966e.js";import"./capabilities-d3148205.js";import"./context-util-09fcc133.js";import"./Util-a12911ae.js";import"./EffectView-7a98f2c6.js";import"./MapImageLayer-030c7912.js";import"./scaleUtils-2aca77b2.js";import"./SublayersOwner-3d3675ca.js";import"./Version-bbcb090a.js";import"./QueryTask-809f5bb4.js";import"./imageBitmapUtils-ce029f55.js";import"./pixelRangeUtils-03719dd8.js";import"./commonProperties-da958896.js";function W(t){let{r:i,g:o,b:r,a}=t;return a<1&&(i=Math.round(a*i+255*(1-a)),o=Math.round(a*o+255*(1-a)),r=Math.round(a*r+255*(1-a))),new z({r:i,g:o,b:r})}function F(t){const{r:i,g:o,b:r}=W(t);return .2126*i+.7152*o+.0722*r}const Z="picture-fill",H="picture-marker",G="simple-fill",I="simple-line",J="simple-marker",K="text",N="Aa",Q=x.size,k=x.maxSize,X=x.maxOutlineSize,Y=x.lineWidth,j=225,_=document.createElement("canvas");function q(t,i){const o=_.getContext("2d"),r=[];return i&&(i.weight&&r.push(i.weight),i.size&&r.push(i.size+"px"),i.family&&r.push(i.family)),o.font=r.join(" "),o.measureText(t).width}const ii=7.2/2.54,ti=72/2.54;function oi(t){if(t.length===0)return 0;if(t.length>2){const i=B(1),o=parseFloat(t);switch(t.slice(-2)){case"px":return o;case"pt":return o*i;case"in":return 72*o*i;case"pc":return 12*o*i;case"mm":return o*ii*i;case"cm":return o*ti*i}}return parseFloat(t)}function M(t){const i=t==null?void 0:t.size;return{width:i!=null&&typeof i=="object"&&"width"in i?v(i.width):null,height:i!=null&&typeof i=="object"&&"height"in i?v(i.height):null}}async function ri(t,i){const o=i.fill,r=t.color;if((o==null?void 0:o.type)==="pattern"&&r&&t.type!==Z){const a=await R(o.src,r.toCss(!0));o.src=a,i.fill=o}}async function mi(t,i,o,r){var h,s,n;if(!("font"in t)||!t.font||i.shape.type!=="text")return;try{await A(t.font)}catch{}const{width:a}=M(r),u=/[\uE600-\uE6FF]/.test(i.shape.text);a!=null||u||(o[0]=q(i.shape.text,{weight:(h=i.font)==null?void 0:h.weight,size:(s=i.font)==null?void 0:s.size,family:(n=i.font)==null?void 0:n.family}))}function E(t,i){return t>i?"dark":"light"}function pi(t,i){var L;const o=typeof(i==null?void 0:i.size)=="number"?i==null?void 0:i.size:null,r=o!=null?v(o):null,a=(i==null?void 0:i.maxSize)!=null?v(i.maxSize):null,u=(i==null?void 0:i.rotation)!=null?i.rotation:"angle"in t?t.angle:null,h=D(t);let s=T(t);ei(t,245)!=="dark"||i!=null&&i.ignoreWhiteSymbols||(s={width:.75,...s,color:"#bdc3c7"});const n={shape:null,fill:h,stroke:s,offset:[0,0]};s!=null&&s.width&&(s.width=Math.min(s.width,X));const d=(s==null?void 0:s.width)||0;let g=(i==null?void 0:i.size)!=null&&((i==null?void 0:i.scale)==null||(i==null?void 0:i.scale)),m=0,p=0,b=!1;switch(t.type){case J:{const l=t.style,{width:c,height:e}=M(i),w=c===e&&c!=null?c:r??Math.min(v(t.size),a||k);switch(m=w,p=w,l){case"circle":n.shape={type:"circle",cx:0,cy:0,r:.5*w},g||(m+=d,p+=d);break;case"cross":n.shape={type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[m,.5*p]},{command:"M",values:[.5*m,0]},{command:"L",values:[.5*m,p]}]};break;case"diamond":n.shape={type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[.5*m,0]},{command:"L",values:[m,.5*p]},{command:"L",values:[.5*m,p]},{command:"Z",values:[]}]},g||(m+=d,p+=d);break;case"square":n.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,p]},{command:"L",values:[0,p]},{command:"Z",values:[]}]},g||(m+=d,p+=d),u&&(b=!0);break;case"triangle":n.shape={type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,p]},{command:"L",values:[0,p]},{command:"Z",values:[]}]},g||(m+=d,p+=d),u&&(b=!0);break;case"x":n.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,p]},{command:"M",values:[m,0]},{command:"L",values:[0,p]}]},u&&(b=!0);break;case"path":n.shape={type:"path",path:t.path||""},g||(m+=d,p+=d),u&&(b=!0),g=!0}break}case I:{const{width:l,height:c}=M(i),e=c??r??d,w=l??Y;s&&(s.width=e),m=w,p=e;const y=((L=n==null?void 0:n.stroke)==null?void 0:L.cap)||"butt",f=y==="round";g=!0,n.stroke&&(n.stroke.cap=y==="butt"?"square":y),n.shape={type:"path",path:[{command:"M",values:[f?e/2:0,p/2]},{command:"L",values:[f?m-e/2:m,p/2]}]};break}case Z:case G:{const l=typeof(i==null?void 0:i.symbolConfig)=="object"&&(i==null?void 0:i.symbolConfig.isSquareFill),{width:c,height:e}=M(i);m=!l&&c!==e||c==null?r??Q:c,p=!l&&c!==e||e==null?m:e,g||(m+=d,p+=d),g=!0,n.shape=l?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,p]},{command:"L",values:[0,p]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:U.fill[0];break}case H:{const l=Math.min(v(t.width),a||k),c=Math.min(v(t.height),a||k),{width:e,height:w}=M(i),y=e===w&&e!=null?e:r??Math.max(l,c),f=l/c;m=f<=1?Math.ceil(y*f):y,p=f<=1?y:Math.ceil(y/f),n.shape={type:"image",x:-Math.round(m/2),y:-Math.round(p/2),width:m,height:p,src:t.url||""},u&&(b=!0);break}case K:{const l=t,c=(i==null?void 0:i.overrideText)||l.text||N,e=l.font,{width:w,height:y}=M(i),f=y??r??Math.min(v(e.size),a||k),O=q(c,{weight:e.weight,size:f,family:e.family}),S=/[\uE600-\uE6FF]/.test(c);m=w??(S?f:O),p=f;let C=.25*oi((e?f:0).toString());S&&(C+=5),n.shape={type:"text",text:c,x:l.xoffset||0,y:l.yoffset||C,align:"middle",alignBaseline:l.verticalAlignment,decoration:e&&e.decoration,rotated:l.rotated,kerning:l.kerning},n.font=e&&{size:f,style:e.style,decoration:e.decoration,weight:e.weight,family:e.family};break}}return{shapeDescriptor:n,size:[m,p],renderOptions:{node:i==null?void 0:i.node,scale:g,opacity:i==null?void 0:i.opacity,rotation:u,useRotationSize:b,effectView:i==null?void 0:i.effectView}}}async function xr(t,i){const{shapeDescriptor:o,size:r,renderOptions:a}=pi(t,i);if(!o.shape)throw new P("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ri(t,o),await mi(t,o,r,i);const u=[[o]];if(typeof(i==null?void 0:i.symbolConfig)=="object"&&(i!=null&&i.symbolConfig.applyColorModulation)){const h=.6*r[0];u.unshift([{...o,offset:[-h,0],fill:$(o.fill,-.3)}]),u.push([{...o,offset:[h,0],fill:$(o.fill,.3)}]),r[0]+=2*h,a.scale=!1}return V(u,r,a)}function ei(t,i=j){const o=D(t),r=T(t),a=!o||"type"in o?null:new z(o),u=r!=null&&r.color?new z(r==null?void 0:r.color):null,h=a?E(F(a),i):null,s=u?E(F(u),i):null;return s?h?h===s?h:i>=j?"light":"dark":s:h}export{ei as getContrastingBackgroundTheme,pi as getRenderSymbolParameters,xr as previewSymbol2D};
