import{l as z}from"./Color-5e799d63.js";import{a as P}from"./Error-781981d1.js";import{n as A}from"./fontUtils-dae2860f.js";import{u as v,e as B}from"./screenUtils-7afeb41c.js";import{f as D,y as T,h as R}from"./utils-e3b2b426.js";import{t as x,y as U,z as $,g as V}from"./symbolUtils-17e1ef41.js";import"./colorUtils-639f4d25.js";import"./mathUtils-15f63a45.js";import"./typedArrayUtil-74bbfd45.js";import"./ensureType-125d327f.js";import"./string-75082bc6.js";import"./preload-helper-f8378b50.js";import"./symbols-df54e69f.js";import"./Accessor-815cb0cf.js";import"./watch-c7facfb0.js";import"./ArrayPool-ae2ef0ab.js";import"./nextTick-3ee5a785.js";import"./promiseUtils-28f2a985.js";import"./CIMSymbol-e48b86be.js";import"./enumeration-94b1319d.js";import"./cast-f7d2a22f.js";import"./Extent-8fae2379.js";import"./JSONSupport-2b897629.js";import"./fieldUtils-e6cf5e5f.js";import"./geometry-0d19f94b.js";import"./Polyline-40b9e769.js";import"./typeUtils-3bf84b36.js";import"./opacityUtils-107b33de.js";import"./symbolLayerUtils3D-15190f75.js";import"./aaBoundingBox-5e14079b.js";import"./request-ae7029ea.js";import"./persistableUrlUtils-73be900a.js";import"./Collection-912f4315.js";import"./Evented-3dfb26f2.js";import"./SimpleObservable-729c9019.js";import"./collectionUtils-5a99c1c0.js";import"./Portal-2a7c40a2.js";import"./Loadable-6776e4d9.js";import"./Promise-092442f7.js";import"./locale-30120714.js";import"./PortalGroup-d3a43002.js";import"./PortalUser-c84fcbac.js";import"./Clonable-6d5134c7.js";import"./asyncUtils-5c97747c.js";import"./jsonUtils-0607c004.js";import"./parser-527c5e80.js";import"./mat4f32-60a2394b.js";import"./mat4-a8da3f27.js";import"./assets-01239caf.js";import"./ItemCache-dc80b100.js";import"./MemCache-9d81d118.js";import"./utils-1aab1134.js";import"./number-5e819186.js";import"./intl-b6f3ccd9.js";import"./messages-dc0c80a1.js";import"./LegendOptions-540a8245.js";import"./jsonUtils-ee8d96d0.js";import"./UniqueValueRenderer-206098f5.js";import"./reactiveUtils-31da19f9.js";import"./diffUtils-0b07ec68.js";import"./colorRamps-f3b121e7.js";import"./sizeVariableUtils-d4870b0d.js";import"./visualVariableUtils-6b4a3e98.js";import"./Graphic-3183b8e9.js";import"./PopupTemplate-c559259f.js";import"./ActionToggle-dc9b6fc6.js";import"./Identifiable-f5397426.js";import"./jsonUtils-15ca15d7.js";import"./compilerUtils-024563a4.js";import"./lengthUtils-40356f92.js";import"./jsonUtils-053e809e.js";import"./layerUtils-7438cb6b.js";import"./styleUtils-9f3a9a37.js";import"./DictionaryLoader-37853497.js";import"./LRUCache-425021b3.js";import"./deprecate-da2b7904.js";import"./heatmapUtils-8c1efe72.js";import"./vec4f64-aa64c7e9.js";import"./colorUtils-c0f43caf.js";import"./jsxFactory-3315acca.js";import"./uuid-73213768.js";import"./mat2d-68947564.js";import"./webStyleSymbolUtils-3aa191ea.js";import"./devEnvironmentUtils-5002a058.js";function W(i){let{r:e,g:t,b:o,a:m}=i;return m<1&&(e=Math.round(m*e+255*(1-m)),t=Math.round(m*t+255*(1-m)),o=Math.round(m*o+255*(1-m))),new z({r:e,g:t,b:o})}function F(i){const{r:e,g:t,b:o}=W(i);return .2126*e+.7152*t+.0722*o}const Z="picture-fill",H="picture-marker",G="simple-fill",I="simple-line",J="simple-marker",K="text",N="Aa",Q=x.size,k=x.maxSize,X=x.maxOutlineSize,Y=x.lineWidth,j=225,_=document.createElement("canvas");function q(i,e){const t=_.getContext("2d"),o=[];return e&&(e.weight&&o.push(e.weight),e.size&&o.push(e.size+"px"),e.family&&o.push(e.family)),t.font=o.join(" "),t.measureText(i).width}const ee=7.2/2.54,ie=72/2.54;function te(i){if(i.length===0)return 0;if(i.length>2){const e=B(1),t=parseFloat(i);switch(i.slice(-2)){case"px":return t;case"pt":return t*e;case"in":return 72*t*e;case"pc":return 12*t*e;case"mm":return t*ee*e;case"cm":return t*ie*e}}return parseFloat(i)}function M(i){const e=i==null?void 0:i.size;return{width:e!=null&&typeof e=="object"&&"width"in e?v(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?v(e.height):null}}async function oe(i,e){const t=e.fill,o=i.color;if((t==null?void 0:t.type)==="pattern"&&o&&i.type!==Z){const m=await R(t.src,o.toCss(!0));t.src=m,e.fill=t}}async function ae(i,e,t,o){var h,l,s;if(!("font"in i)||!i.font||e.shape.type!=="text")return;try{await A(i.font)}catch{}const{width:m}=M(o),u=/[\uE600-\uE6FF]/.test(e.shape.text);m!=null||u||(t[0]=q(e.shape.text,{weight:(h=e.font)==null?void 0:h.weight,size:(l=e.font)==null?void 0:l.size,family:(s=e.font)==null?void 0:s.family}))}function E(i,e){return i>e?"dark":"light"}function re(i,e){var L;const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,o=t!=null?v(t):null,m=(e==null?void 0:e.maxSize)!=null?v(e.maxSize):null,u=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in i?i.angle:null,h=D(i);let l=T(i);ne(i,245)!=="dark"||e!=null&&e.ignoreWhiteSymbols||(l={width:.75,...l,color:"#bdc3c7"});const s={shape:null,fill:h,stroke:l,offset:[0,0]};l!=null&&l.width&&(l.width=Math.min(l.width,X));const d=(l==null?void 0:l.width)||0;let g=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),a=0,r=0,b=!1;switch(i.type){case J:{const p=i.style,{width:c,height:n}=M(e),w=c===n&&c!=null?c:o??Math.min(v(i.size),m||k);switch(a=w,r=w,p){case"circle":s.shape={type:"circle",cx:0,cy:0,r:.5*w},g||(a+=d,r+=d);break;case"cross":s.shape={type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[a,.5*r]},{command:"M",values:[.5*a,0]},{command:"L",values:[.5*a,r]}]};break;case"diamond":s.shape={type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*r]},{command:"L",values:[.5*a,r]},{command:"Z",values:[]}]},g||(a+=d,r+=d);break;case"square":s.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,r]},{command:"L",values:[0,r]},{command:"Z",values:[]}]},g||(a+=d,r+=d),u&&(b=!0);break;case"triangle":s.shape={type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,r]},{command:"L",values:[0,r]},{command:"Z",values:[]}]},g||(a+=d,r+=d),u&&(b=!0);break;case"x":s.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,r]},{command:"M",values:[a,0]},{command:"L",values:[0,r]}]},u&&(b=!0);break;case"path":s.shape={type:"path",path:i.path||""},g||(a+=d,r+=d),u&&(b=!0),g=!0}break}case I:{const{width:p,height:c}=M(e),n=c??o??d,w=p??Y;l&&(l.width=n),a=w,r=n;const y=((L=s==null?void 0:s.stroke)==null?void 0:L.cap)||"butt",f=y==="round";g=!0,s.stroke&&(s.stroke.cap=y==="butt"?"square":y),s.shape={type:"path",path:[{command:"M",values:[f?n/2:0,r/2]},{command:"L",values:[f?a-n/2:a,r/2]}]};break}case Z:case G:{const p=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:c,height:n}=M(e);a=!p&&c!==n||c==null?o??Q:c,r=!p&&c!==n||n==null?a:n,g||(a+=d,r+=d),g=!0,s.shape=p?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,r]},{command:"L",values:[0,r]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:U.fill[0];break}case H:{const p=Math.min(v(i.width),m||k),c=Math.min(v(i.height),m||k),{width:n,height:w}=M(e),y=n===w&&n!=null?n:o??Math.max(p,c),f=p/c;a=f<=1?Math.ceil(y*f):y,r=f<=1?y:Math.ceil(y/f),s.shape={type:"image",x:-Math.round(a/2),y:-Math.round(r/2),width:a,height:r,src:i.url||""},u&&(b=!0);break}case K:{const p=i,c=(e==null?void 0:e.overrideText)||p.text||N,n=p.font,{width:w,height:y}=M(e),f=y??o??Math.min(v(n.size),m||k),O=q(c,{weight:n.weight,size:f,family:n.family}),S=/[\uE600-\uE6FF]/.test(c);a=w??(S?f:O),r=f;let C=.25*te((n?f:0).toString());S&&(C+=5),s.shape={type:"text",text:c,x:p.xoffset||0,y:p.yoffset||C,align:"middle",alignBaseline:p.verticalAlignment,decoration:n&&n.decoration,rotated:p.rotated,kerning:p.kerning},s.font=n&&{size:f,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family};break}}return{shapeDescriptor:s,size:[a,r],renderOptions:{node:e==null?void 0:e.node,scale:g,opacity:e==null?void 0:e.opacity,rotation:u,useRotationSize:b,effectView:e==null?void 0:e.effectView}}}async function Pi(i,e){const{shapeDescriptor:t,size:o,renderOptions:m}=re(i,e);if(!t.shape)throw new P("symbolPreview: renderPreviewHTML2D","symbol not supported.");await oe(i,t),await ae(i,t,o,e);const u=[[t]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&(e!=null&&e.symbolConfig.applyColorModulation)){const h=.6*o[0];u.unshift([{...t,offset:[-h,0],fill:$(t.fill,-.3)}]),u.push([{...t,offset:[h,0],fill:$(t.fill,.3)}]),o[0]+=2*h,m.scale=!1}return V(u,o,m)}function ne(i,e=j){const t=D(i),o=T(i),m=!t||"type"in t?null:new z(t),u=o!=null&&o.color?new z(o==null?void 0:o.color):null,h=m?E(F(m),e):null,l=u?E(F(u),e):null;return l?h?h===l?h:e>=j?"light":"dark":l:h}export{ne as getContrastingBackgroundTheme,re as getRenderSymbolParameters,Pi as previewSymbol2D};
