import{r as c,t as p,b as E,s as m,d as _,f as $,e as w,a as v,v as b}from"./Accessor-815cb0cf.js";import{i as D,N as J}from"./typedArrayUtil-74bbfd45.js";import{p as P}from"./string-75082bc6.js";import{e as f,u as j,s as h,o as d}from"./watch-c7facfb0.js";import{a as A,s as T}from"./Error-781981d1.js";let U=class y{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(r){const e=new y;return this._values.forEach((t,i)=>{r&&r.has(i)||e.set(i,P(t.value),t.origin)}),e}get(r,e){e=this._normalizeOrigin(e);const t=this._values.get(r);return e==null||(t==null?void 0:t.origin)===e?t==null?void 0:t.value:void 0}originOf(r){var e;return((e=this._values.get(r))==null?void 0:e.origin)??c.USER}keys(r){r=this._normalizeOrigin(r);const e=[...this._values.keys()];return r==null?e:e.filter(t=>{var i;return((i=this._values.get(t))==null?void 0:i.origin)===r})}set(r,e,t){if((t=this._normalizeOrigin(t))===c.DEFAULTS){const i=this._values.get(r);if(i&&i.origin!=null&&i.origin>t)return}this._values.set(r,new z(e,t))}delete(r,e){var t;(e=this._normalizeOrigin(e))!=null&&((t=this._values.get(r))==null?void 0:t.origin)!==e||this._values.delete(r)}has(r,e){var t;return(e=this._normalizeOrigin(e))!=null?((t=this._values.get(r))==null?void 0:t.origin)===e:this._values.has(r)}forEach(r){this._values.forEach(({value:e},t)=>r(e,t))}_normalizeOrigin(r){if(r!=null)return r===c.DEFAULTS?r:c.USER}};class z{constructor(r,e){this.value=r,this.origin=e}}function L(s,r,e){r.keys().forEach(i=>{e.set(i,r.get(i),c.DEFAULTS)});const t=s.metadatas;Object.keys(t).forEach(i=>{s.internalGet(i)&&e.set(i,s.internalGet(i),c.DEFAULTS)})}function k(s,r,e){if(!s||!s.read||s.read.enabled===!1||!s.read.source)return!1;const t=s.read.source;if(typeof t=="string"){if(t===r||t.includes(".")&&t.indexOf(r)===0&&h(t,e))return!0}else for(const i of t)if(i===r||i.includes(".")&&i.indexOf(r)===0&&h(i,e))return!0;return!1}function q(s){return s&&(!s.read||s.read.enabled!==!1&&!s.read.source)}function x(s,r,e,t,i){let n=p(r[e],i);q(n)&&(s[e]=!0);for(const o of Object.getOwnPropertyNames(r))n=p(r[o],i),k(n,e,t)&&(s[o]=!0)}function F(s,r,e,t){const i=e.metadatas,n=E(i[r],"any",t),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(s,r,t):o;a!==void 0&&e.set(r,a)}const N={origin:"service"};function R(s,r,e=N){if(!r||typeof r!="object")return;const t=f(s),i=t.metadatas,n={};for(const o of Object.getOwnPropertyNames(r))x(n,i,o,r,e);t.setDefaultOrigin(e.origin);for(const o of Object.getOwnPropertyNames(n)){const a=p(i[o],e).read,u=a&&a.source;let l;l=u&&typeof u=="string"?j(r,u):r[o],a&&a.reader&&(l=a.reader.call(s,l,r,e)),l!==void 0&&t.set(o,l)}if(!e||!e.ignoreDefaults){t.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(i))n[o]||F(s,o,t,e)}t.setDefaultOrigin("user")}function X(s,r,e,t=N){var n;const i={...t,messages:[]};e(i),(n=i.messages)==null||n.forEach(o=>{o.type!=="warning"||s.loaded?t&&t.messages&&t.messages.push(o):s.loadWarnings.push(o)})}function C(s,r,e,t,i){var o,a;const n={};return(a=(o=r.write)==null?void 0:o.writer)==null||a.call(s,t,n,e,i),n}function S(s,r,e,t,i,n){if(!t||!t.write)return!1;const o=s.get(e);if(!i&&t.write.overridePolicy){const a=t.write.overridePolicy.call(s,o,e,n);a!==void 0&&(i=a)}if(i||(i=t.write),!i||i.enabled===!1)return!1;if((o===null&&!i.allowNull&&!i.writerEnsuresNonNull||o===void 0)&&i.isRequired){const a=new A("web-document-write:property-required",`Missing value for required property '${e}' on '${s.declaredClass}'`,{propertyName:e,target:s});return a&&n&&n.messages?n.messages.push(a):a&&!n&&T.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!i.allowNull&&!i.writerEnsuresNonNull||(!r.store.multipleOriginsSupported||r.store.originOf(e)===c.DEFAULTS)&&G(s,e,n,t,o)||!i.ignoreOrigin&&n&&n.origin&&r.store.multipleOriginsSupported&&r.store.originOf(e)<$(n.origin))}function G(s,r,e,t,i){const n=t.default;if(n===void 0)return!1;if(t.defaultEquals!=null)return t.defaultEquals(i);if(typeof n=="function"){if(Array.isArray(i)){const o=n.call(s,r,e);return D(o,i)}return!1}return n===i}function Y(s,r,e,t){const i=f(s),n=i.metadatas,o=m(n[r],t);return!!o&&S(s,i,r,o,e,t)}function M(s,r,e){var n,o;if(s&&typeof s.toJSON=="function"&&(!s.toJSON.isDefaultToJSON||!s.write))return d(r,s.toJSON(e));const t=f(s),i=t.metadatas;for(const a in i){const u=m(i[a],e);if(!S(s,t,a,u,void 0,e))continue;const l=s.get(a),g=C(s,u,u.write&&typeof u.write.target=="string"?u.write.target:a,l,e);Object.keys(g).length>0&&(r=d(r,g),(o=(n=e==null?void 0:e.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&e.resources.pendingOperations.push(Promise.all(e.resources.pendingOperations).then(()=>d(r,g,()=>"replace-arrays"))),e&&e.writtenProperties&&e.writtenProperties.push({target:s,propName:a,oldOrigin:_(t.store.originOf(a)),newOrigin:e.origin}))}return r}const W=s=>{let r=class extends s{constructor(...e){super(...e);const t=J(f(this)),i=t.store,n=new U;t.store=n,L(t,i,n)}read(e,t){R(this,e,t)}write(e={},t){return M(this,e,t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return B.call(this,e,t)}};return r=w([v("esri.core.JSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function B(s,r){if(!s)return null;if(s.declaredClass)throw new Error("JSON object is already hydrated");const e=new this;return e.read(s,r),e}let O=class extends W(b){};O=w([v("esri.core.JSONSupport")],O);export{R as a,Y as c,X as d,L as e,M as g,O as l,W as u};
