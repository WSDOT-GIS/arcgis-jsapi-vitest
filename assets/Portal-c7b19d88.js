import{_ as m}from"./preload-helper-fb43855a.js";import{e as r,y as o,a as B,v as C}from"./Accessor-815cb0cf.js";import{b as v,a as S}from"./Error-781981d1.js";import{r as I,U as q,a as f}from"./request-6e1d5843.js";import{u as A}from"./JSONSupport-2b897629.js";import{m as M}from"./Loadable-6776e4d9.js";import{p as E,r as T}from"./typedArrayUtil-74bbfd45.js";import{f as O,p as G,a as D,w}from"./promiseUtils-28f2a985.js";import{b as N}from"./ensureType-125d327f.js";import{o as c,w as L}from"./Extent-8fae2379.js";import{l as P}from"./locale-30120714.js";import{d as g}from"./PortalGroup-d3a43002.js";import H from"./PortalUser-a3f3561a.js";let y=class extends C{constructor(t){super(t),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};r([o()],y.prototype,"nextQueryParams",void 0),r([o()],y.prototype,"queryParams",void 0),r([o()],y.prototype,"results",void 0),r([o()],y.prototype,"total",void 0),y=r([B("esri.portal.PortalQueryResult")],y);const $=y;var p;let _;const U={PortalGroup:()=>m(()=>import("./PortalGroup-d3a43002.js").then(t=>t.P),["assets/PortalGroup-d3a43002.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/JSONSupport-2b897629.js","assets/cast-f7d2a22f.js","assets/Extent-8fae2379.js"]),PortalItem:()=>m(()=>import("./PortalItem-90bf2143.js"),["assets/PortalItem-90bf2143.js","assets/preload-helper-fb43855a.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/assets-7bd3ffcf.js","assets/request-6e1d5843.js","assets/JSONSupport-2b897629.js","assets/Loadable-6776e4d9.js","assets/Promise-092442f7.js","assets/Extent-8fae2379.js","assets/cast-f7d2a22f.js","assets/locale-30120714.js","assets/PortalGroup-d3a43002.js","assets/PortalUser-a3f3561a.js"]),PortalUser:()=>m(()=>import("./PortalUser-a3f3561a.js"),["assets/PortalUser-a3f3561a.js","assets/preload-helper-fb43855a.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/JSONSupport-2b897629.js","assets/PortalGroup-d3a43002.js","assets/cast-f7d2a22f.js","assets/Extent-8fae2379.js"])};let e=p=class extends A(M){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=v.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=E(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const s of t)v.request.trustedServers.includes(s)||v.request.trustedServers.push(s);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const s=t.indexOf("/sharing");t=s>0?t.substring(0,s):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,s=this.thumbnail;return t&&s?this._normalizeSSL(t+"/portals/self/resources/"+s):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let s=null;return t&&(s=H.fromJSON(t),s.portal=this),s}load(t){const s=m(()=>import("./Basemap-c8601fc5.js").then(i=>i.B),["assets/Basemap-c8601fc5.js","assets/preload-helper-fb43855a.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/Collection-912f4315.js","assets/Evented-3dfb26f2.js","assets/SimpleObservable-729c9019.js","assets/collectionUtils-5a99c1c0.js","assets/deprecate-da2b7904.js","assets/JSONSupport-2b897629.js","assets/Loadable-6776e4d9.js","assets/Promise-092442f7.js","assets/loadAll-38268fb1.js","assets/asyncUtils-5c97747c.js","assets/request-6e1d5843.js","assets/Extent-8fae2379.js","assets/cast-f7d2a22f.js","assets/PortalItem-90bf2143.js","assets/assets-7bd3ffcf.js","assets/locale-30120714.js","assets/PortalGroup-d3a43002.js","assets/PortalUser-a3f3561a.js","assets/messages-dc0c80a1.js","assets/writeUtils-8884705e.js","assets/layerUtils-5e9bebc1.js"]).then(({default:i})=>{O(t),_=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(f){const l=f;this.credential=l.findCredential(this.restUrl),this.credential||this.authMode!==p.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=l.on("credential-create",()=>{l.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(s),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),s=(await m(()=>import("./ElevationLayer-b792b8c0.js"),["assets/ElevationLayer-b792b8c0.js","assets/preload-helper-fb43855a.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/request-6e1d5843.js","assets/MultiOriginJSONSupport-6a5e69d5.js","assets/JSONSupport-2b897629.js","assets/Extent-8fae2379.js","assets/cast-f7d2a22f.js","assets/HeightModelInfo-0c04472c.js","assets/Layer-9c99e5a9.js","assets/geometry-0d19f94b.js","assets/Polyline-40b9e769.js","assets/typeUtils-3bf84b36.js","assets/Evented-3dfb26f2.js","assets/Identifiable-f5397426.js","assets/Loadable-6776e4d9.js","assets/Promise-092442f7.js","assets/ArcGISCachedService-c50a24b2.js","assets/TilemapCache-04fb347f.js","assets/TileInfo-1aef4d7f.js","assets/aaBoundingRect-3cd21eb0.js","assets/mathUtils-15f63a45.js","assets/TileKey-b87e0dc5.js","assets/byteSizeEstimations-90c5a50d.js","assets/HandleOwner-124247b4.js","assets/reactiveUtils-31da19f9.js","assets/LRUCache-425021b3.js","assets/MemCache-9d81d118.js","assets/ArcGISService-04cf234b.js","assets/arcgisLayerUrl-94ca51fa.js","assets/persistableUrlUtils-0364346d.js","assets/OperationalLayer-be76a501.js","assets/commonProperties-3eba42f9.js","assets/TimeExtent-202e4138.js","assets/ElevationInfo-89e4d39d.js","assets/fieldUtils-85274dd9.js","assets/lengthUtils-40356f92.js","assets/opacityUtils-107b33de.js","assets/PortalLayer-ab74a160.js","assets/asyncUtils-5c97747c.js","assets/layerUtils-5e9bebc1.js","assets/PortalItem-90bf2143.js","assets/assets-7bd3ffcf.js","assets/locale-30120714.js","assets/PortalGroup-d3a43002.js","assets/PortalUser-a3f3561a.js","assets/portalItemUtils-2867876d.js","assets/projection-6de68766.js","assets/SimpleObservable-729c9019.js","assets/mat4-a8da3f27.js","assets/zscale-a617710a.js","assets/workers-79a370d4.js","assets/Connection-4113b752.js","assets/Queue-687500af.js","assets/intl-71e7974a.js","assets/number-5e819186.js","assets/messages-dc0c80a1.js"])).default;return t?t.map(i=>new s({id:i.id,url:i.url})):[]}fetchBasemaps(t,s){const i=new g;return i.query=t||(v.apiKey&&I(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,s).then(l=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',l.total){const a=l.results[0];return i.sortField=a.sortField||"name",i.sortOrder=a.sortOrder||"desc",a.queryItems(i,s)}return null}).then(l=>{let a;return a=l&&l.total?l.results.filter(n=>n.type==="Web Map").map(n=>new _({portalItem:n})):[],a})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(s=>s.categorySchema):G(t)?Promise.reject(D()):Promise.resolve([])}fetchFeaturedGroups(t){const s=this.featuredGroups,i=new g;if(i.num=100,i.sortField="title",s&&s.length){const l=[];for(const a of s)l.push(`(title:"${a.title}" AND owner:${a.owner})`);return i.query=l.join(" OR "),this.queryGroups(i,t).then(a=>a.results)}return G(t)?Promise.reject(D()):Promise.resolve([])}fetchRegions(t){var i;const s=((i=this.user)==null?void 0:i.culture)||this.culture||P();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:s}})}fetchSettings(t){var i;const s=((i=this.user)==null?void 0:i.culture)||this.culture||P();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:s}})}static getDefault(){return p._default&&!p._default.destroyed||(p._default=new p),p._default}queryGroups(t,s){return this.queryPortal("/community/groups",t,"PortalGroup",s)}queryItems(t,s){return this.queryPortal("/search",t,"PortalItem",s)}queryUsers(t,s){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",s)}fetchSelf(t=this.authMode,s=!1,i){const l=this.restUrl+"/portals/self",a={authMode:t,query:{culture:P().toLowerCase()},...i};return a.authMode==="auto"&&(a.authMode="no-prompt"),s&&(a.query.default=!0),this.request(l,a)}queryPortal(t,s,i,l){const a=N(g,s),n=h=>this.request(this.restUrl+t,{...a.toRequestOptions(this),...l}).then(u=>{const d=a.clone();return d.start=u.nextStart,new $({nextQueryParams:d,queryParams:a,total:u.total,results:p._resultsToTypedArray(h,{portal:this},u,l)})}).then(u=>Promise.all(u.results.map(d=>typeof d.when=="function"?d.when():u)).then(()=>u,d=>(w(d),u)));return i&&U[i]?U[i]().then(({default:h})=>(O(l),n(h))):n()}signIn(){if(this.authMode===p.AUTH_MODE_ANONYMOUS)return Promise.reject(new S("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=s=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(s||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=s,this.fetchSelf("immediate"))):this.user&&this.credential===s?null:(this.credential=s,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return f?f.getCredential(this.restUrl).then(s=>t(s)):t(this.credential)}normalizeUrl(t){const s=this.credential&&this.credential.token;return this._normalizeSSL(s?t+(t.includes("?")?"&":"?")+"token="+s:t)}requestToTypedArray(t,s,i){return this.request(t,s).then(l=>{const a=p._resultsToTypedArray(i,{portal:this},l);return Promise.all(a.map(n=>typeof n.when=="function"?n.when():l)).then(()=>a,()=>a)})}request(t,s={}){const i={f:"json",...s.query},{authMode:l=this.authMode===p.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:a=null,cacheBust:n=!1,method:h="auto",responseType:u="json",signal:d}=s,Q={authMode:l,body:a,cacheBust:n,method:h,query:i,responseType:u,timeout:0,signal:d};return q(this._normalizeSSL(t),Q).then(b=>b.data)}toJSON(){throw new S("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new p({sourceJSON:t})}_getHelperService(t){const s=this.helperServices&&this.helperServices[t];if(!s)throw new S("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return s}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const s=_.fromJSON(t);return s.portalItem={portal:this},s}return null}static _resultsToTypedArray(t,s,i,l){let a=[];if(i){const n=T(l)?l.signal:null;a=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||s)&&(a=a.map(h=>{const u=Object.assign(t?t.fromJSON(h):h,s);return typeof u.load=="function"&&u.load(n),u}))}else a=[];return a}};e.AUTH_MODE_ANONYMOUS="anonymous",e.AUTH_MODE_AUTO="auto",e.AUTH_MODE_IMMEDIATE="immediate",r([o()],e.prototype,"access",void 0),r([o()],e.prototype,"allSSL",void 0),r([o()],e.prototype,"authMode",void 0),r([o()],e.prototype,"authorizedCrossOriginDomains",void 0),r([c("authorizedCrossOriginDomains")],e.prototype,"readAuthorizedCrossOriginDomains",null),r([o()],e.prototype,"basemapGalleryGroupQuery",void 0),r([o()],e.prototype,"bingKey",void 0),r([o()],e.prototype,"canListApps",void 0),r([o()],e.prototype,"canListData",void 0),r([o()],e.prototype,"canListPreProvisionedItems",void 0),r([o()],e.prototype,"canProvisionDirectPurchase",void 0),r([o()],e.prototype,"canSearchPublic",void 0),r([o()],e.prototype,"canShareBingPublic",void 0),r([o()],e.prototype,"canSharePublic",void 0),r([o()],e.prototype,"canSignInArcGIS",void 0),r([o()],e.prototype,"canSignInIDP",void 0),r([o()],e.prototype,"colorSetsGroupQuery",void 0),r([o()],e.prototype,"commentsEnabled",void 0),r([o({type:Date})],e.prototype,"created",void 0),r([o()],e.prototype,"credential",void 0),r([o()],e.prototype,"culture",void 0),r([o()],e.prototype,"currentVersion",void 0),r([o()],e.prototype,"customBaseUrl",void 0),r([o()],e.prototype,"defaultBasemap",void 0),r([c("defaultBasemap")],e.prototype,"readDefaultBasemap",null),r([o()],e.prototype,"defaultDevBasemap",void 0),r([c("defaultDevBasemap")],e.prototype,"readDefaultDevBasemap",null),r([o({type:L})],e.prototype,"defaultExtent",void 0),r([o()],e.prototype,"defaultVectorBasemap",void 0),r([c("defaultVectorBasemap")],e.prototype,"readDefaultVectorBasemap",null),r([o()],e.prototype,"description",void 0),r([o()],e.prototype,"devBasemapGalleryGroupQuery",void 0),r([o()],e.prototype,"eueiEnabled",void 0),r([o({readOnly:!0})],e.prototype,"extraQuery",null),r([o()],e.prototype,"featuredGroups",void 0),r([o()],e.prototype,"featuredItemsGroupQuery",void 0),r([o()],e.prototype,"galleryTemplatesGroupQuery",void 0),r([o()],e.prototype,"livingAtlasGroupQuery",void 0),r([o()],e.prototype,"hasCategorySchema",void 0),r([o()],e.prototype,"helpBase",void 0),r([o()],e.prototype,"helperServices",void 0),r([o()],e.prototype,"helpMap",void 0),r([o()],e.prototype,"homePageFeaturedContent",void 0),r([o()],e.prototype,"homePageFeaturedContentCount",void 0),r([o()],e.prototype,"httpPort",void 0),r([o()],e.prototype,"httpsPort",void 0),r([o()],e.prototype,"id",void 0),r([o()],e.prototype,"ipCntryCode",void 0),r([o({readOnly:!0})],e.prototype,"isOrganization",null),r([o()],e.prototype,"isPortal",void 0),r([o()],e.prototype,"isReadOnly",void 0),r([o({readOnly:!0})],e.prototype,"itemPageUrl",null),r([o()],e.prototype,"layerTemplatesGroupQuery",void 0),r([o()],e.prototype,"maxTokenExpirationMinutes",void 0),r([o({type:Date})],e.prototype,"modified",void 0),r([o()],e.prototype,"name",void 0),r([o()],e.prototype,"portalHostname",void 0),r([o()],e.prototype,"portalMode",void 0),r([o()],e.prototype,"portalProperties",void 0),r([o()],e.prototype,"region",void 0),r([o({readOnly:!0})],e.prototype,"restUrl",null),r([o()],e.prototype,"rotatorPanels",void 0),r([o()],e.prototype,"showHomePageDescription",void 0),r([o()],e.prototype,"sourceJSON",void 0),r([o()],e.prototype,"staticImagesUrl",void 0),r([o({json:{name:"2DStylesGroupQuery"}})],e.prototype,"stylesGroupQuery2d",void 0),r([o({json:{name:"stylesGroupQuery"}})],e.prototype,"stylesGroupQuery3d",void 0),r([o()],e.prototype,"supportsHostedServices",void 0),r([o()],e.prototype,"symbolSetsGroupQuery",void 0),r([o()],e.prototype,"templatesGroupQuery",void 0),r([o()],e.prototype,"thumbnail",void 0),r([o({readOnly:!0})],e.prototype,"thumbnailUrl",null),r([o()],e.prototype,"units",void 0),r([o()],e.prototype,"url",void 0),r([o()],e.prototype,"urlKey",void 0),r([c("urlKey")],e.prototype,"readUrlKey",null),r([o()],e.prototype,"user",void 0),r([c("user")],e.prototype,"readUser",null),r([o()],e.prototype,"useStandardizedQuery",void 0),r([o()],e.prototype,"useVectorBasemaps",void 0),r([o()],e.prototype,"vectorBasemapGalleryGroupQuery",void 0),e=p=r([B("esri.portal.Portal")],e);const tt=e;export{tt as b};
