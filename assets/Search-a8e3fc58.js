import{e as i,y as o,a as N,v as Et,k as Xe}from"./Accessor-815cb0cf.js";import{s as Ye}from"./intl-b83d6b45.js";import{E as fe,U as Ft,i as Ie}from"./promiseUtils-28f2a985.js";import{l as de,j as He,h as $e,a as Nt}from"./reactiveUtils-31da19f9.js";import{p as pe,a as kt,d as jt}from"./string-75082bc6.js";import{b as Z}from"./ensureType-125d327f.js";import{t as ge,r as q,g as he}from"./typedArrayUtil-74bbfd45.js";import{e as Re,W as et,n as g,v as ve,A as At,k as Pt}from"./jsxFactory-2cf3af56.js";import{a as Gt}from"./assets-fff829c9.js";import{s as Se,a as T,b as Te}from"./Error-781981d1.js";import{g as Ce}from"./Graphic-f65f3c78.js";import{k as tt}from"./PopupTemplate-a7832b3e.js";import{n as Ot,m as Dt,S as Bt,g as Kt}from"./symbols-d9f90967.js";import{j as zt}from"./Collection-912f4315.js";import{n as Ht}from"./Evented-3dfb26f2.js";import{w as xe,$ as Ut,a as te,f as be,R as Vt}from"./Extent-8fae2379.js";import{s as Wt}from"./locale-30120714.js";import{u as Jt}from"./messages-dc0c80a1.js";import{b as Ne}from"./Portal-0799d17c.js";import{t as qt,a as Zt}from"./GoTo-a612a338.js";import{s as Qt}from"./Identifiable-f5397426.js";import{l as G}from"./JSONSupport-2b897629.js";import{v as st,m as rt}from"./Polyline-40b9e769.js";import{c as Xt}from"./FullTextSearch-da95615f.js";import"./geometry-0d19f94b.js";import{d as Yt}from"./scaleUtils-7da28fc4.js";import{L as es}from"./number-5e819186.js";import{U as ke}from"./request-b4e08038.js";import{f as je,s as Ae,i as Pe}from"./utils-14667ccd.js";import{t as Ge}from"./commonProperties-da958896.js";import{a as re}from"./cast-f7d2a22f.js";import{v as se}from"./jsonUtils-15ca15d7.js";import{a as ts,n as ss}from"./project-d4657d9d.js";import{t as Ue}from"./accessibleHandler-46d8c8f2.js";import{e as rs}from"./vmEvent-d773b6c5.js";import"./watch-c7facfb0.js";import"./ArrayPool-ae2ef0ab.js";import"./nextTick-3ee5a785.js";import"./Promise-092442f7.js";import"./uuid-73213768.js";import"./Clonable-6d5134c7.js";import"./fieldUtils-39eb4f5d.js";import"./preload-helper-101896b7.js";import"./enumeration-94b1319d.js";import"./ActionToggle-dc9b6fc6.js";import"./CIMSymbol-2f4be01b.js";import"./Color-5e799d63.js";import"./colorUtils-639f4d25.js";import"./mathUtils-15f63a45.js";import"./screenUtils-7afeb41c.js";import"./opacityUtils-107b33de.js";import"./symbolLayerUtils3D-15190f75.js";import"./aaBoundingBox-5e14079b.js";import"./persistableUrlUtils-5532b98d.js";import"./collectionUtils-5a99c1c0.js";import"./SimpleObservable-729c9019.js";import"./Loadable-6776e4d9.js";import"./PortalGroup-d3a43002.js";import"./PortalUser-092553f2.js";import"./typeUtils-3bf84b36.js";import"./utils-067ee6bc.js";const S="esri-search",h={base:`${S} esri-widget`,loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:`${S}--multiple-sources`,isLoading:`${S}--loading`,isSearching:`${S}--searching`,showSuggestions:`${S}--show-suggestions`,showSources:`${S}--sources`,showWarning:`${S}--warning`,container:`${S}__container`,input:`${S}__input`,inputContainer:`${S}__input-container`,form:`${S}__form`,submitButton:`${S}__submit-button`,sourcesButton:`${S}__sources-button`,clearButton:`${S}__clear-button`,sourceName:`${S}__source-name`,suggestionsMenu:`${S}__suggestions-menu`,suggestionList:`${S}__suggestions-list`,suggestionListCurrentLocation:`${S}__suggestions-list--current-location`,sourcesMenu:`${S}__sources-menu`,source:`${S}__source`,warningMenu:`${S}__warning-menu`,warningMenuBody:`${S}__warning-body`,warningMenuHeader:`${S}__warning-header`,warningMenuText:`${S}__warning-text`,noValueText:`${S}__no-value-text`,esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},X="esri-search-result-renderer",B={base:`${X} esri-widget`,anchor:"esri-widget__anchor",showMoreResults:`${X}__more-results--show-more-results`,moreResults:`${X}__more-results`,moreResultsList:`${X}__more-results-list`,moreResultsHeader:`${X}__more-results-header`,moreResultsItem:`${X}__more-results-item`,moreResultsListHeader:`${X}__more-results-list-header`};let I=class extends Qt(G){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};i([o()],I.prototype,"autoNavigate",void 0),i([o()],I.prototype,"filter",void 0),i([o()],I.prototype,"getResults",void 0),i([o()],I.prototype,"getSuggestions",void 0),i([o()],I.prototype,"maxResults",void 0),i([o()],I.prototype,"maxSuggestions",void 0),i([o()],I.prototype,"minSuggestCharacters",void 0),i([o()],I.prototype,"outFields",void 0),i([o()],I.prototype,"placeholder",void 0),i([o()],I.prototype,"popupEnabled",void 0),i([o()],I.prototype,"popupTemplate",void 0),i([o()],I.prototype,"prefix",void 0),i([o()],I.prototype,"resultGraphicEnabled",void 0),i([o()],I.prototype,"resultSymbol",void 0),i([o()],I.prototype,"suggestionsEnabled",void 0),i([o()],I.prototype,"suffix",void 0),i([o()],I.prototype,"withinViewEnabled",void 0),i([o()],I.prototype,"zoomScale",void 0),I=i([N("esri.widgets.Search.SearchSource")],I);const Oe=I,Ve=Se.getLogger("esri.widgets.Search.support.geometryUtils");function is(e,t){var r,n;if(!t)return Ve.error("missing-parameter: view is missing."),Promise.reject(new T("searchgeometryutils:missing-parameter","view is missing."));if(!e)return Ve.error("missing-parameter: point is missing."),Promise.reject(new T("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||t.type==="2d")return Promise.resolve(e);const s=(r=t==null?void 0:t.map)==null?void 0:r.ground;return s&&s.layers.length?s.queryElevation(e,{cache:(n=t.basemapTerrain)==null?void 0:n.elevationQueryCache}).then(l=>l.geometry):Promise.resolve(e)}function We(e){if(ge(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function De(e,t,s){return ge(e)?null:e.type==="extent"?e:e.type==="multipoint"||e.type==="polygon"||e.type==="polyline"?e.extent:e.type==="point"?it(e,t,s):void 0}function Le(e,t,s){return ge(e)||ge(t)?null:it(e.center,t,s)}function it(e,t,s){const r=e.hasZ?e.z:void 0;return t&&t.map?(s?Yt(t,s):t.extent).clone().centerAt(e).set({zmax:r,zmin:r}):new xe({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:r,zmax:r})}const os=/https?:\/\/services.*\.arcgis\.com/i,ns=/(?:\{([^}]+)\})/g,ae=Se.getLogger("esri.widgets.Search.support.layerSearchUtils");function ls(e,t){const{exactMatch:s=!1,location:r,maxResults:n,spatialReference:l,source:a,sourceIndex:u,suggestResult:c,view:d}=e,{layer:p,filter:_,zoomScale:v}=a,m=d&&d.scale,w=ot(a,d),x=t&&t.signal;return lt(p).then(()=>{const C=p.popupTemplate;return C?C.getRequiredFields(p.fieldsIndex):null}).then(C=>{var ye,Ke,ze;const{objectIdField:b,returnZ:k}=p,A=pt(a);if(!Be(p,A))throw ae.error("invalid-field: displayField is invalid."),new T("getResults():invalid-field","displayField is invalid.");const $=C&&C.length?C:[A],R=a.outFields||$,O=nt(R);if(R.includes(b)||O||R.push(b),(ye=p.floorInfo)!=null&&ye.floorField&&R.push(p.floorInfo.floorField),!(O||we(p,R)))throw ae.error("invalid-field: outField is invalid."),new T("getResults():invalid-field","outField is invalid.");const M=p.createQuery(),{orderByFields:Q}=a;if(Q&&(M.orderByFields=Q),l){M.outSpatialReference=l;const D=1/Ut(l);D&&(M.maxAllowableOffset=D)}const me=p.geometryType==="mesh"||p.geometryType==="multipatch",ue=((ze=(Ke=p.capabilities)==null?void 0:Ke.data)==null?void 0:ze.supportsZ)&&!me;if(M.returnZ=ue&&k!==!1,M.returnGeometry=!0,M.multipatchOption=me?"xyFootprint":null,R&&(M.outFields=R),r)M.geometry=r;else if(c.key)M.objectIds=[c.key];else{const D=a.searchFields||[A];if(!we(p,D))throw ae.error("invalid-field: search field is invalid."),new T("getResults():invalid-field","search field is invalid.");if(ht(p)&&(M.num=n),w&&(M.geometry=w),!c.text.trim())return[];const Me=c.text,{prefix:Rt="",suffix:Tt=""}=a,Ct=gt(`${Rt}${Me}${Tt}`);dt(p)&&ut(p,D)&&!s&&Me&&(M.fullText=ct({text:Me,searchFields:D}));const Lt=mt({searchTerm:Ct,layer:p,searchFields:D,filter:_,exactMatch:s,query:M,type:"search"});if(M.where=Lt,!at(M))return[]}return p.queryFeatures(M,{signal:x}).then(D=>_s(D,d,a,u,A,m,v))})}function as(e,t){const{source:s,spatialReference:r,view:n,suggestTerm:l,maxSuggestions:a,sourceIndex:u,exactMatch:c}=e,{layer:d,filter:p}=s,_=t&&t.signal,v=ot(s,n);return lt(d).then(()=>{if(!ht(d))return[];const m=pt(s),w=s.searchFields||[m],x=[];s.suggestionTemplate?s.suggestionTemplate.replace(ns,(ue,ye)=>(x.push(ye),ue)):x.push(m);const C=nt(x);x.includes(d.objectIdField)||C||x.push(d.objectIdField);const b=Be(d,m),k=C||we(d,x),A=we(d,w);if(!b)throw ae.error("invalid-field: displayField is invalid."),new T("getSuggestions():invalid-field","displayField is invalid.");if(!k)throw ae.error("invalid-field: outField is invalid."),new T("getSuggestions():invalid-field","outField is invalid.");if(!A)throw ae.error("invalid-field: search field is invalid."),new T("getSuggestions():invalid-field","search field is invalid.");const $=d.createQuery(),{orderByFields:R}=s;if(R&&($.orderByFields=R),$.outSpatialReference=r,$.returnGeometry=!1,$.num=a,$.outFields=x,v&&($.geometry=v),!l.trim())return[];const{prefix:O="",suffix:M=""}=s,Q=gt(`${O}${l}${M}`);dt(d)&&ut(d,w)&&!c&&l&&($.fullText=ct({text:l,searchFields:w}));const me=mt({searchTerm:Q,layer:d,searchFields:w,filter:p,exactMatch:c,query:$,type:"suggest"});return $.where=me,at($)?d.queryFeatures($,{signal:_}).then(ue=>fs(ue,s,u,m)):[]})}function ot(e,t){const{filter:s,withinViewEnabled:r}=e,n=t&&t.extent;return s&&s.geometry||(r&&n?n:void 0)}function nt(e){return e&&e.includes("*")}async function lt(e){e&&await e.load()}function at(e){return!(!e.fullText&&!e.where)}function ut(e,t){const s=e==null?void 0:e.indexes;return!s||!(t!=null&&t.length)?!1:s.filter(r=>r.indexType==="FullText").some(r=>{var l;const n=((l=r.fields)==null?void 0:l.split(",").map(a=>a.trim().toLowerCase()))||[];return t.every(a=>n.includes(a.toLowerCase()))})}function ct({text:e,searchFields:t}){return e.trim().split(" ").filter(s=>!!s.trim()).map(s=>new Xt({onFields:t,searchTerm:s,searchType:"prefix"}))}function dt(e){var t,s;return((s=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:s.supportsFullTextSearch)??!1}function ht(e){var t,s;return((s=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:s.supportsPagination)??!1}function us(e){var t,s,r;return((r=(s=(t=e==null?void 0:e.fieldsIndex)==null?void 0:t.fields)==null?void 0:s.find(n=>n.type==="string"))==null?void 0:r.name)??""}function pt(e){return e.displayField||e.layer.displayField||us(e.layer)}function we(e,t){return!(!e||!(t!=null&&t.length))&&t.every(s=>Be(e,s))}function Be(e,t){return!!e.getField(t)}function cs(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function ds(e,t,s){let r=null;const{codedValues:n}=e;return n&&n.some(l=>{const a=l.name,u=s?a:a.toLowerCase();return(s?t:t.toLowerCase())===u&&(r=l.code.toString(),!0)}),r}function gt(e){return e.replace(/\'/g,"''")}function ce(e,t){const s=t&&t.where;return s?`(${e}) AND (${s})`:e}function hs({currentTerm:e,field:t,filter:s,exactMatch:r,url:n,type:l}){const a=t.type,u=t.name;if(a==="string"||a==="date"||a==="global-id"){const c=os.test(n),d=c&&cs(e)?"N":"";return ce(r&&l==="search"?`${u} = ${d}'${e}'`:c?`${u} LIKE ${d}${`'${e}%'`}`:`${`LOWER(${u})`} LIKE ${d}${`'${e.toLowerCase()}%'`}`,s)}if(a==="oid"||a==="small-integer"||a==="integer"||a==="single"||a==="double"){const c=Number(e);return isNaN(c)?null:ce(`${u} = ${c}`,s)}return ce(`${u} = ${e}`,s)}function ps(e,t){return e?` OR (${t})`:`(${t})`}function mt({searchTerm:e,layer:t,searchFields:s,filter:r,exactMatch:n,query:l,type:a}){const{definitionExpression:u,url:c}=t;let d="";return!l.fullText&&e&&s&&s.forEach(p=>{const _=t.getField(p),v=typeof t.getFieldDomain=="function"&&t.getFieldDomain(p),m=(v&&v.type==="coded-value"?ds(v,e,n):null)||e||null;if(m!==null){const w=hs({currentTerm:m,field:_,filter:r,exactMatch:n,url:c,type:a});w&&(d+=ps(d,w))}}),u&&d?`(${u}) AND (${d})`:u||d}function gs(e,t){let s=null;const{codedValues:r}=e;return r&&r.length&&r.some(n=>n.code===t&&(s=n.name,!0)),s}function ms(e,t){return e[Object.keys(e).find(s=>s.toLowerCase()===t.toLowerCase())]}function yt(e,t,s){const r=e.sourceLayer,{attributes:n}=e,l=typeof r.getFieldDomain=="function"&&r.getFieldDomain(s);if(t)return Ye(t,n);if(s&&n){const a=r.getField(s),u=ms(n,s);return u==null?"":l&&l.type==="coded-value"?gs(l,u):(a==null?void 0:a.type)==="date"?es(new Date(u)):typeof u=="number"?u.toString():typeof u!="string"?"":u.trim()}return""}function ys(e,t,s,r){const n=e.sourceLayer,{attributes:l}=e,{objectIdField:a}=n,u=l[a];return{text:yt(e,t.suggestionTemplate,r),key:u,sourceIndex:s}}function fs(e,t,s,r){return e.features.map(n=>ys(n,t,s,r))}function vs(e,t,s,r,n,l,a){const u=e.clone(),c=e.sourceLayer,d=c&&c.objectIdField,p=d&&e.attributes[d],_=yt(e,s.searchTemplate,n),v=De(u.geometry,t,l),m=typeof a=="number"?Le(pe(v),t,a):v,w=e.clone();return q(m)&&(w.geometry=st.fromExtent(m)),{extent:m,target:w,feature:u,key:p,name:_,sourceIndex:r}}function _s(e,t,s,r,n,l,a){return e.features.map(u=>vs(u,t,s,r,n,l,a))}var Ee;let P=Ee=class extends Oe{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,s)=>ls({source:this,...t},s),this.getSuggestions=(t,s)=>as({source:this,...t},s)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new Ee({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?pe(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?pe(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e;return((e=this.layer.fieldsIndex.fields.find(t=>t.type==="string"))==null?void 0:e.name)??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(s=>{const r=e.getField(s);return r&&r.alias||s}).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};i([o({json:{read:{source:"field.name"},write:{target:"field.name"}}})],P.prototype,"displayField",void 0),i([o({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],P.prototype,"exactMatch",void 0),i([o({value:null})],P.prototype,"layer",null),i([o()],P.prototype,"name",null),i([o({type:[String],json:{write:!0}})],P.prototype,"orderByFields",void 0),i([o()],P.prototype,"searchFields",void 0),i([o()],P.prototype,"searchTemplate",void 0),i([o()],P.prototype,"suggestionTemplate",void 0),P=Ee=i([N("esri.widgets.Search.LayerSearchSource")],P);const ie=P;function ws(e){return!!e&&typeof e.x=="number"&&typeof e.y=="number"}function Ss(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}let W=class extends G{constructor(t){super(t),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};i([o({type:String,json:{write:!0}})],W.prototype,"address",void 0),i([o({type:Object,json:{write:!0}})],W.prototype,"attributes",void 0),i([o({type:xe,json:{write:!0}})],W.prototype,"extent",void 0),i([o({type:te,json:{write:!0}})],W.prototype,"location",void 0),i([o({type:Number,json:{write:!0}})],W.prototype,"score",void 0),W=i([N("esri.rest.support.AddressCandidate")],W);const ft=W;let L=class extends G{constructor(t){super(t),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};i([o({type:Object,json:{write:!0}})],L.prototype,"address",void 0),i([o(Ge)],L.prototype,"apiKey",void 0),i([o({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],L.prototype,"categories",void 0),i([o({type:String,json:{write:!0}})],L.prototype,"countryCode",void 0),i([o({type:Boolean,json:{write:!0}})],L.prototype,"forStorage",void 0),i([o({type:te,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],L.prototype,"location",void 0),i([o({type:String,json:{write:!0}})],L.prototype,"locationType",void 0),i([o({type:String,json:{write:!0}})],L.prototype,"magicKey",void 0),i([o({type:Number,json:{write:!0}})],L.prototype,"maxLocations",void 0),i([o({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],L.prototype,"outFields",void 0),i([o({type:be,json:{read:{source:"outSR"},write:{target:"outSR"}}})],L.prototype,"outSpatialReference",void 0),i([o({type:xe,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=s}}}})],L.prototype,"searchExtent",void 0),L=i([N("esri.rest.support.AddressToLocationsParameters")],L),L.from=Z(L);const vt=L;async function xs(e,t,s){t=vt.from(t);const r=je(e),{address:n,...l}=t.toJSON(),a={...n,...l,f:"json"},u=Ae({...r.query,...a}),c=Pe(u,s),d=`${r.path}/findAddressCandidates`;return ke(d,c).then(bs)}function bs({data:e}){if(!e)return[];const{candidates:t,spatialReference:s}=e;return t?t.map(r=>{if(!r)return;const{extent:n,location:l}=r,a=!n||Ss(n);return ws(l)&&a?(n&&(n.spatialReference=s),l&&(l.spatialReference=s),ft.fromJSON(r)):void 0}):[]}let H=class extends G{constructor(t){super(t),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};i([o(Ge)],H.prototype,"apiKey",void 0),i([o({type:te,json:{write:{writer:(e,t)=>{const s=e?e.clone().normalize():null,r=s!==void 0;t.location=r?s:null}}}})],H.prototype,"location",void 0),i([o({type:String,json:{write:!0}})],H.prototype,"locationType",void 0),i([o({type:be,json:{read:{source:"outSR"},write:{target:"outSR"}}})],H.prototype,"outSpatialReference",void 0),H=i([N("esri.rest.support.LocationToAddressParameters")],H),H.from=Z(H);const _t=H;async function Ms(e,t,s){t=_t.from(t);const r=je(e),n={...t.toJSON(),f:"json"},l=Ae({...r.query,...n}),a=Pe(l,s),u=`${r.path}/reverseGeocode`;return ke(u,a).then(Is)}function Is({data:e}){if(!e)return;const{address:t,location:s}=e,r=t&&t.Match_addr||"";return ft.fromJSON({address:r,attributes:t||{},location:s,score:100})}let oe=class extends G{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};i([o({type:Boolean,json:{write:!0}})],oe.prototype,"isCollection",void 0),i([o({type:String,json:{write:!0}})],oe.prototype,"magicKey",void 0),i([o({type:String,json:{write:!0}})],oe.prototype,"text",void 0),oe=i([N("esri.rest.support.SuggestionCandidate")],oe);const $s=oe;let j=class extends G{constructor(t){super(t),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};i([o(Ge)],j.prototype,"apiKey",void 0),i([o({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],j.prototype,"categories",void 0),i([o({type:String,json:{write:!0}})],j.prototype,"countryCode",void 0),i([o({type:te,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],j.prototype,"location",void 0),i([o({type:Number,json:{write:!0}})],j.prototype,"maxSuggestions",void 0),i([o({type:be,json:{read:{source:"outSR"},write:{target:"outSR"}}})],j.prototype,"outSpatialReference",void 0),i([o({type:xe,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(s)}}}})],j.prototype,"searchExtent",void 0),i([o({type:String,json:{write:!0}})],j.prototype,"text",void 0),j=i([N("esri.rest.support.SuggestLocationsParameters")],j),j.from=Z(j);const wt=j;async function Rs(e,t,s){const r=je(e),n={...(t=wt.from(t)).toJSON(),f:"json"},l=Ae({...r.query,...n}),a=Pe(l,s),u=`${r.path}/suggest`;return ke(u,a).then(Ts)}function Ts(e){const{data:t}=e;if(!t)return[];const{suggestions:s}=t;return s?s.map(r=>new $s(r)):[]}const Cs="Single Line Input",Ls=3e5;function Es(e,t){return e.location?As(e,t):Ps(e,t)}function St(e,t){if(t.localSearchDisabled)return null;const s=e==null?void 0:e.scale;return typeof s=="number"&&s<=Ls?e.get("extent.center"):null}function Fs(e,t){const{source:s,spatialReference:r,view:n,suggestTerm:l,maxSuggestions:a,sourceIndex:u}=e,c=new wt,{apiKey:d,url:p}=s,_=xt(s,n),v=t&&t.signal;if(!p)return Promise.resolve(null);d&&(c.apiKey=d),s.categories&&(c.categories=s.categories),r&&(c.outSpatialReference=r);const m=St(n,s);if(m&&(c.location=m),!l.trim())return Promise.resolve(null);const{prefix:w="",suffix:x=""}=s,C=`${w}${l}${x}`;return c.text=C,_&&(c.searchExtent=he(_)),c.maxSuggestions=a,s.countryCode&&(c.countryCode=s.countryCode),Rs(p,c,{signal:v}).then(b=>Os(b,u))}function Ns(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function ks(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Je(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const js="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";function As(e,t){const{source:s,spatialReference:r,location:n,sourceIndex:l,view:a}=e,{apiKey:u,url:c,zoomScale:d,defaultZoomScale:p}=s,_=a&&a.scale,v=t&&t.signal,m=new _t;return m.location=n,u&&(m.apiKey=u),r&&(m.outSpatialReference=r),Ms(c,m,{signal:v}).then(w=>bt([w],{sourceIndex:l,scale:_,view:a,zoomScale:d,defaultZoomScale:p})).catch(()=>[])}function xt(e,t){const{filter:s,withinViewEnabled:r}=e,n=t&&t.scale,l=t&&t.extent,a=s&&s.geometry;return De(a,t,n)||(r&&l?l:void 0)}function Ps(e,t){const{source:s,suggestResult:r,spatialReference:n,view:l,maxResults:a,sourceIndex:u}=e,c=s&&s.zoomScale,d=s&&s.defaultZoomScale;if(!r.text.trim())return Promise.resolve(null);const p=!r.key&&s.prefix?s.prefix:"",_=!r.key&&s.suffix?s.suffix:"",v=`${p}${r.text}${_}`,m=new vt,{apiKey:w,url:x}=s,C=l&&l.scale,b=xt(s,l),k=t&&t.signal;if(w&&(m.apiKey=w),!x)return Promise.resolve(null);s.categories&&(m.categories=s.categories),s.locationType&&(m.locationType=s.locationType),n&&(m.outSpatialReference=n);const A=St(l,s);A&&(m.location=A),m.maxLocations=a,b&&(m.searchExtent=he(b)),s.countryCode&&(m.countryCode=s.countryCode);const{key:$}=r,R=`${$}`;return $&&(m.magicKey=R),m.address={},m.address[s.singleLineFieldName||Cs]=v,s.outFields&&(m.outFields=s.outFields),xs(x,m,{signal:k}).then(O=>bt(O,{key:R,scale:C,sourceIndex:u,view:l,zoomScale:c,defaultZoomScale:d}))}function Gs(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function Os(e,t){return e.map(s=>Gs(s,t))}function Ds(e,t){const{key:s,scale:r,sourceIndex:n,view:l,zoomScale:a,defaultZoomScale:u}=t,{attributes:c,extent:d,location:p,address:_}=e,v=new Ce({geometry:p,attributes:c}),m=d||p,w=De(m,l,r),x=typeof a=="number"?Le(w,l,a):typeof u=="number"&&m.type==="point"?Le(w,l,u):w,C=p?`${p.x},${p.y}`:"",b=_||C,k=v.clone();return q(x)&&(k.geometry=st.fromExtent(x)),{extent:x,feature:v,target:k,key:s,name:b,sourceIndex:n}}function bt(e,t){return e.filter(Boolean).map(s=>Ds(s,t))}var Fe;const Bs="esri.widgets.Search.LocatorSearchSource";let F=Fe=class extends Oe{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,s)=>Es({source:this,...t},s),this.getSuggestions=(t,s)=>Fs({source:this,...t},s)}clone(){return new Fe({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?pe(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?pe(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};i([o()],F.prototype,"apiKey",void 0),i([o()],F.prototype,"categories",void 0),i([o()],F.prototype,"countryCode",void 0),i([o({json:{write:!0}})],F.prototype,"defaultZoomScale",void 0),i([o()],F.prototype,"localSearchDisabled",void 0),i([o()],F.prototype,"locationType",void 0),i([o({json:{write:!0}})],F.prototype,"name",void 0),i([o({json:{write:!0}})],F.prototype,"placeholder",void 0),i([o()],F.prototype,"searchTemplate",void 0),i([o({json:{write:!0}})],F.prototype,"singleLineFieldName",void 0),i([o({json:{read:{source:"suggest"},write:{target:"suggest"}}})],F.prototype,"suggestionsEnabled",void 0),i([o({json:{write:!0}})],F.prototype,"url",void 0),i([o({json:{write:!0}})],F.prototype,"zoomScale",void 0),F=Fe=i([N(Bs)],F);const Mt=F;new re({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});new re({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let Y=class extends G{constructor(t){super(t),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};i([o({type:String,json:{write:!0}})],Y.prototype,"deviationUnit",void 0),i([o({json:{read:{reader:e=>e?e.map(t=>se(t)).filter(q):null},write:{writer:(e,t)=>{t.geometries=(e==null?void 0:e.map(s=>s.toJSON()))??null}}}})],Y.prototype,"geometries",void 0),i([o({type:Number,json:{write:!0}})],Y.prototype,"maxDeviation",void 0),Y=i([N("esri.rest.support.GeneralizeParameters")],Y),Y.from=Z(Y);new re({preserveShape:"preserve-shape"});let U=class extends G{constructor(t){super(t),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};i([o({type:String,json:{write:!0}})],U.prototype,"calculationType",void 0),i([o({type:Boolean,json:{write:!0}})],U.prototype,"geodesic",void 0),i([o({json:{write:!0}})],U.prototype,"lengthUnit",void 0),i([o({type:[rt],json:{read:{reader:e=>e?e.map(t=>se(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(s=>s.toJSON())}}}})],U.prototype,"polylines",void 0),U=i([N("esri.rest.support.LengthsParameters")],U),U.from=Z(U);new re({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"});new re({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let K=class extends G{constructor(t){super(t),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};i([o({type:Number,json:{write:!0}})],K.prototype,"bevelRatio",void 0),i([o({json:{read:{reader:e=>e?e.map(t=>se(t)).filter(q):null},write:{writer:(e,t)=>{t.geometries=(e==null?void 0:e.map(s=>s.toJSON()))??null}}}})],K.prototype,"geometries",void 0),i([o({type:Number,json:{write:!0}})],K.prototype,"offsetDistance",void 0),i([o({type:String,json:{write:!0}})],K.prototype,"offsetHow",void 0),i([o({type:String,json:{write:!0}})],K.prototype,"offsetUnit",void 0),K=i([N("esri.rest.support.OffsetParameters")],K),K.from=Z(K);new re({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let V=class extends G{constructor(t){super(t),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};i([o({json:{read:{reader:e=>e?e.map(t=>se(t)).filter(q):null},write:{writer:(e,t)=>{t.geometries1=(e==null?void 0:e.map(s=>s.toJSON()))??null}}}})],V.prototype,"geometries1",void 0),i([o({json:{read:{reader:e=>e?e.map(t=>se(t)).filter(q):null},write:{writer:(e,t)=>{t.geometries2=(e==null?void 0:e.map(s=>s.toJSON()))??null}}}})],V.prototype,"geometries2",void 0),i([o({type:String,json:{write:!0}})],V.prototype,"relation",void 0),i([o({type:String,json:{write:!0}})],V.prototype,"relationParameter",void 0),V=i([N("esri.rest.support.RelationParameters")],V),V.from=Z(V);new re({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let ee=class extends G{constructor(e){super(e),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};i([o({type:String,json:{write:!0}})],ee.prototype,"extendHow",void 0),i([o({type:[rt],json:{read:{reader:e=>e?e.map(t=>se(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(s=>s.toJSON())}}}})],ee.prototype,"polylines",void 0),i([o({json:{read:{reader:e=>e?se(e):null},write:{writer:(e,t)=>{t.trimExtendTo=e.toJSON()}}}})],ee.prototype,"trimExtendTo",void 0),ee=i([N("esri.rest.support.TrimExtendParameters")],ee),ee.from=Z(ee);const It=Se.getLogger("esri.widgets.support.geolocationUtils"),Ks={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function zs(){const e=kt("esri-geolocation");return e||It.warn("geolocation-unsupported","Geolocation unsupported."),e}function Hs(){const e=window.isSecureContext;return e||It.warn("insecure-context","Geolocation requires a secure origin."),e}function qe(){return zs()&&Hs()}function Us(e){return e||(e=Ks),new Promise((s,r)=>{setTimeout(()=>r(new T("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(s,r,e)})}function Vs(e,t){var l;const{position:s,view:r}=e,n=(l=Ws(s))==null?void 0:l.coords;if(!n)throw new T("geometry-service:no-coords","Geolocation has no coordinates");return qs(Js(n),r,t)}function Ws(e){const t=e&&e.coords||{},s={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:s,timestamp:e.timestamp}}function Js({longitude:e,latitude:t,altitude:s}){return new te({longitude:e,latitude:t,z:s||void 0,spatialReference:{wkid:4326}})}function qs(e,t,s){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(Vt(e)):Zs(s).then(n=>{if(!n)throw new T("geometry-service:missing-url","Geometry service URL is missing");const l=new ts({geometries:[e],outSpatialReference:r});return ss(n,l,s).then(a=>a[0])})}function Zs(e){if(Te.geometryServiceUrl)return Promise.resolve(Te.geometryServiceUrl);const t=Ne.getDefault();return t.load(e).catch(()=>{}).then(()=>t.get("helperServices.geometry.url"))}function E(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}const Qs=()=>Jt("esri/widgets/Search/t9n/Search"),$t="esri.widgets.Search.SearchViewModel",z=Se.getLogger($t),Ze="highlight",_e=zt.ofType({key:e=>e.layer?"layer":"locator",base:Oe,typeMap:{layer:ie,locator:Mt}}),Qe=be.WGS84,Xs="esri/images/search/search-symbol-32.png",Ys=/<(?:.|\s)*?>/g,ne=-1;let y=class extends qt(Ht.EventedMixin(Et)){constructor(e){super(e),this._handles=new Xe,this._gotoController=null,this._searching=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new _e,this.defaultSymbols={point:new Ot({url:Gt(Xs),size:24,width:24,height:24}),polyline:new Dt({color:[130,130,130,1],width:2}),polygon:new Bt({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=Ne.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new _e,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const t=await Qs();this.messages=t,this.defaultPopupTemplate=new tt({title:t.searchResult,content:"{Match_addr}"})};e(),this._handles.add([de(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),$e),Wt(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:ne}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){var e;return(e=this.messages)==null?void 0:e.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,r=typeof s=="function"?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,n=this._get("allSources")||new _e;return n.removeAll(),n.addMany(r.filter(Boolean)),n}get locationEnabled(){return this._get("locationEnabled")||qe()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");const t=qe();if(e&&!t){const s=new T("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});z.error(s)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;if(t===ne)return s;const r=e.at(t);return r?r.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),r=this.when().then(()=>this._getResultsFromSources(s,t).then(n=>{var c;if((c=he(t==null?void 0:t.signal))!=null&&c.aborted)return null;const l={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(l,n,s);const a=this._getFirstResult(l.results),u=(s.location&&a?a.name:s.text).replace(Ys,"");return this._set("searchTerm",u),(s.key&&typeof s.sourceIndex=="number"||s.location)&&this._set("selectedSuggestion",s),this._set("results",l.results),this._set("resultCount",l.results.reduce((d,p)=>d+p.results.length,0)),this.emit("search-complete",l),this._selectFirstResult(a).then(()=>l)})).then(n=>(this._clearSearching(),n),n=>{throw this._clearSearching(),n});return this._searching=r,r}searchNearby(e){if(!this.locationEnabled){const s=new T("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return z.error(s),Promise.reject(s)}const t=Us().then(s=>Vs({position:s,view:this.view},e)).then(s=>this.search(s,e));return this._searching=t,t.catch(()=>{}).then(()=>this._clearSearching()),t}select(e){if(this.clearGraphics(),!e){const b=new T("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return z.error(b),Promise.reject(b)}const{view:t}=this,s=E(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=this.allSources.at(s);if(!r){const b=new T("select:missing-source","Cannot select without a source.",{source:r});return z.error(b),Promise.reject(b)}const n=r instanceof ie?this._getLayerSourcePopupTemplate(r):r.popupTemplate,l=r.resultSymbol||this._getDefaultSymbol(e),a=E(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,u=E(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,c=E(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,d=c?n||this.popupTemplate||this.defaultPopupTemplate:null,{feature:p}=e;if(!p){const b=new T("select:missing-feature","Cannot select without a feature.",{feature:p});return z.error(b),Promise.reject(b)}const{attributes:_,geometry:v,layer:m,sourceLayer:w}=p,x=We(v),C={layerViewQuery:this._getLayerView(p),elevationQuery:t&&q(x)?is(x,t).catch(()=>x):Promise.resolve(x)};return fe(C).then(b=>{const k=b.layerViewQuery.value,A=b.elevationQuery.value;l instanceof Kt&&(l.text=e.name);const $=t&&u?e.target||e.extent:null;return(q($)?this._goToSearchResult($):Promise.resolve()).then(()=>{var Q;const R=k?p:new Ce({geometry:v,symbol:l,attributes:_,layer:m,sourceLayer:w,popupTemplate:d}),O=c&&((Q=this.view)==null?void 0:Q.popup),M=O&&R.getEffectivePopupTemplate(O.defaultPopupTemplateEnabled);return M&&t.popup.open({features:[R],location:A}),k&&Zt(k)&&!M&&this._highlightFeature({graphic:R,layerView:k}),!k&&a&&t&&t.graphics.push(R),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",R),this.emit("select-result",{result:e,source:r,sourceIndex:s}),e})})}suggest(e,t,s){const r=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:r}),this._suggestTimer(t,s).then(()=>this._suggestImmediate(r,s).then(n=>(this._set("suggestions",n.results),this._set("suggestionCount",n.results.reduce((l,a)=>l+a.results.length,0)),this.emit("suggest-complete",n),n)))}async when(){await He(()=>!this.updating)}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=fe([e==null?void 0:e.load(),t==null?void 0:t.when()]);if(this.destroyed||(await s,s!==this._updatingPromise))return}await He(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){var t,s;const e=(s=(t=this.portal)==null?void 0:t.helperServices)==null?void 0:s.geocode;return e?e.map(r=>{if(r.placefinding===!1)return;const n=Te.apiKey&&Je(r.url)?{url:js}:null,l=Mt.fromJSON({...r,...n}),a=l.url;if(Je(a)||ks(a)||Ns(a)){const u=l.outFields||["Addr_type","Match_addr","StAddr","City"],c=l.placeholder||this.messages.placeholder,d=typeof l.defaultZoomScale=="number"?l.defaultZoomScale:2500;l.set({singleLineFieldName:"SingleLine",outFields:u,placeholder:c,defaultZoomScale:d})}return l.singleLineFieldName?l:void 0}).filter(Boolean):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e==null?void 0:e.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){var r;const s=(r=this.view)==null?void 0:r.map;return e.map(n=>{const l=s.findLayerById(n.id);if(!l)return;const a=this._getLayerJSON(n),u=ie.fromJSON(a);return u.placeholder=t,this._getLayer(l,a).then(c=>{u.layer=c}),u}).filter(Boolean).toArray()}_getTableSources(e,t){var r;const s=(r=this.view)==null?void 0:r.map;return e.map(n=>{const l=s.findTableById(n.id);if(!l)return;const a=this._getLayerJSON(n),u=ie.fromJSON(a);return u.placeholder=t,this._getLayer(l,a).then(c=>{u.layer=c}),u}).filter(Boolean).toArray()}_convertApplicationProperties(){var a,u,c;const e=(a=this.view)==null?void 0:a.map,t=(c=(u=e==null?void 0:e.applicationProperties)==null?void 0:u.viewing)==null?void 0:c.search;if(!t)return[];const{enabled:s,hintText:r,layers:n,tables:l}=t;return s?[...this._getLayerSources(n,r),...this._getTableSources(l,r)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const s=e.allSublayers.find(n=>n.id===t.subLayer);if(!s)throw new Error;const r=await s.createFeatureLayer();return this._createdFeatureLayers.push(r),r}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find(r=>r.id===t.subLayer);if((s==null?void 0:s.type)!=="building-component")throw new Error;if(await s.load(),s.associatedLayer==null)throw new Error;return await s.associatedLayer.load(),s}_getLayer(e,t){return e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature"?Promise.resolve(e):e.type==="map-image"?this._getSubLayer(e,t).catch(()=>{const s=new T("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return z.error(s),null}):e.type==="building-scene"?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var r;const e=(r=this.view)==null?void 0:r.popup,{resultGraphic:t}=this;if(!e||!t)return;const{selectedFeature:s}=e;s&&s===t&&e.close()}_suggestTimer(e,t){const s=e??this.suggestionDelay;return Ft(s,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof Ce?We(e.geometry):e instanceof te?e:Array.isArray(e)&&e.length===2?new te({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&E(e,"key")&&E(e,"text")&&E(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:r,selectedResult:n}=this,l=!e&&r&&n,a=l&&r.key===n.key&&r.sourceIndex===n.sourceIndex,u=l&&r.location;return a||u?r:{location:he(t),text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some(s=>{const{results:r}=s,n=r[0],l=!!n;return l&&(t=n),l}),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then(()=>this._getSuggestionsFromSources(e,t)).then(s=>{var n;if((n=he(t==null?void 0:t.signal))!=null&&n.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,s),r})}_formatSourceResponse(e,t,s){const r=t&&t.value||[],n=t&&t.error,l=this.allSources.at(s);if(n){const a={sourceIndex:s,source:l,error:n};e.errors.push(a),z.error(n),e.numErrors++}else{const a={sourceIndex:s,source:l,results:r};e.results.push(a),e.numResults+=r.length}}_formatResponse(e,t,s){if(t)if(e.activeSourceIndex===ne){const r=s&&E(s,"sourceIndex")&&s.sourceIndex!==-1?s.sourceIndex:void 0;t.forEach((n,l)=>{const a=r!==void 0?r:l;this._formatSourceResponse(e,n,a)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:s}=this,r=!e.location&&E(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,n=[];if(!s.length){const l=new T("search:no-sources-defined","At least one source is required.",{allSources:s});return z.error(l),Promise.reject(l)}return r===ne?s.forEach((l,a)=>{n.push(this._getResultsFromSource(e,a,t))}):n.push(this._getResultsFromSource(e,r,t)),fe(n)}_getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:r}=this,n=[];if(!s.length){const l=new T("suggest:no-sources-defined","At least one source is required.",{allSources:s});return z.error(l),Promise.reject(l)}return r===ne?s.forEach((l,a)=>{n.push(this._getSuggestionsFromSource(e,a,t))}):n.push(this._getSuggestionsFromSource(e,r,t)),fe(n)}_getResultsFromSource(e,t,s){var d;const r=this.allSources.at(t),{location:n=null}=e,l=((d=this.view)==null?void 0:d.spatialReference)||Qe,a=E(r,"maxResults")?r.maxResults:this.maxResults,u=!!(r instanceof ie&&E(r,"exactMatch"))&&r.exactMatch,{view:c}=this;return r.getResults({view:c,sourceIndex:t,location:n,suggestResult:e,spatialReference:l,exactMatch:u,maxResults:a},s)}_getSuggestionsFromSource(e,t,s){var u;const r=this.allSources.at(t),n=E(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,l=e.length,a=E(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(n&&e.trim()&&l>=a){const c=((u=this.view)==null?void 0:u.spatialReference)||Qe,d=E(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:p}=this,_=!!(r instanceof ie&&E(r,"exactMatch"))&&r.exactMatch;return r.getSuggestions({view:p,sourceIndex:t,suggestTerm:e,spatialReference:c,maxSuggestions:d,exactMatch:_},s)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return E(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let s=null;return t.some(r=>r.results.some(n=>n===e&&(s=r.sourceIndex,!0))),s}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const s=new AbortController;this._gotoController=s;const r={target:{target:e},options:{animate:t,signal:s.signal}};await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){var r;const{defaultSymbols:t}=this,s=(r=e.feature)==null?void 0:r.geometry;if(ge(s))return null;switch(s.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this._handles.remove(Ze)}async _getLayerView(e){const{view:t}=this;if(!e||!t||e.layer.type==="building-component"||e.layer.type==="subtype-sublayer")return null;const{layer:s}=e;return await t.when(),t.whenLayerView(s)}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:r,layer:n}=t,{objectIdField:l}=n,a=r&&r[l],u=s.highlight(a||t);this._handles.add(u,Ze)}_setResultFloor(e){var n,l,a;const{view:t}=this,s=(n=e.feature)==null?void 0:n.attributes,r=(l=e.feature)==null?void 0:l.sourceLayer;if(r&&"floorInfo"in r&&((a=r==null?void 0:r.floorInfo)!=null&&a.floorField)&&s){const u=s[r.floorInfo.floorField];t==null||t.emit("select-result-floor",u)}}};y.ALL_INDEX=ne,i([o()],y.prototype,"_searching",void 0),i([o()],y.prototype,"_updatingPromise",void 0),i([o({readOnly:!0,value:null})],y.prototype,"activeSource",null),i([o()],y.prototype,"activeSourceIndex",null),i([o()],y.prototype,"allPlaceholder",null),i([o({readOnly:!0})],y.prototype,"allSources",null),i([o()],y.prototype,"autoNavigate",void 0),i([o()],y.prototype,"autoSelect",void 0),i([o()],y.prototype,"defaultPopupTemplate",void 0),i([o({readOnly:!0})],y.prototype,"defaultSources",void 0),i([o()],y.prototype,"defaultSymbols",void 0),i([o()],y.prototype,"includeDefaultSources",void 0),i([o()],y.prototype,"locationEnabled",null),i([o()],y.prototype,"maxInputLength",void 0),i([o()],y.prototype,"maxResults",void 0),i([o()],y.prototype,"maxSuggestions",void 0),i([o()],y.prototype,"messages",void 0),i([o()],y.prototype,"minSuggestCharacters",void 0),i([o({readOnly:!0})],y.prototype,"placeholder",null),i([o()],y.prototype,"popupEnabled",void 0),i([o({type:tt})],y.prototype,"popupTemplate",void 0),i([o({type:Ne})],y.prototype,"portal",void 0),i([o()],y.prototype,"resultCount",void 0),i([o()],y.prototype,"resultGraphicEnabled",void 0),i([o({readOnly:!0})],y.prototype,"resultGraphic",void 0),i([o({readOnly:!0})],y.prototype,"results",void 0),i([o({readOnly:!0})],y.prototype,"selectedSuggestion",void 0),i([o()],y.prototype,"searchAllEnabled",void 0),i([o({readOnly:!0})],y.prototype,"selectedResult",void 0),i([o()],y.prototype,"searchTerm",null),i([o({type:_e})],y.prototype,"sources",void 0),i([o({readOnly:!0})],y.prototype,"state",null),i([o()],y.prototype,"suggestionDelay",void 0),i([o()],y.prototype,"suggestionCount",void 0),i([o({readOnly:!0})],y.prototype,"suggestions",void 0),i([o()],y.prototype,"suggestionsEnabled",void 0),i([o({readOnly:!0})],y.prototype,"updating",null),i([o()],y.prototype,"view",void 0),i([o()],y.prototype,"clear",null),y=i([N($t)],y);const le=y;let J=class extends et{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){const e={[B.showMoreResults]:this.showMoreResultsOpen};return g("div",{class:B.base},g("div",{key:"esri-search-renderer__container",class:this.classes(B.moreResults,e)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return g("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var s;const e=(s=this.viewModel)==null?void 0:s.selectedResult,t=e&&e.name||"";return g("div",{key:"esri-search-renderer__result-name",class:B.moreResultsItem},t)}renderMoreResultsLists(){var r;const e=(r=this.viewModel)==null?void 0:r.results,{resultCount:t}=this.viewModel;if(t<2)return null;const s=e.map(n=>this.renderMoreResultsList(n));return g("div",{key:"esri-search-renderer__more-results-container",class:B.moreResultsList},s)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:t}=this.viewModel;return t<2?null:g("div",{key:"esri-search-renderer__more-results-button",class:B.moreResultsItem},g("a",{class:B.anchor,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,t){return g("div",{key:`esri-search-result-renderer__header-${t}`,class:B.moreResultsListHeader},e)}renderMoreResultsList(e){var p,_;const{results:t}=e,s=t.length,r=!!s,n=(p=this.viewModel)==null?void 0:p.selectedResult,l=s===1&&t[0]===n,a=this._getSourceName(e.source,e.sourceIndex),u=((_=this.viewModel)==null?void 0:_.results.length)>1&&!l?this.renderMoreResultsHeader(a,e.sourceIndex):null,c=r&&t.map((v,m)=>this.renderMoreResultsListItem(v,m)),d=r&&!l?g("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},c):null;return r?g("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},u,d):null}renderMoreResultsListItem(e,t){return e!==this.get("viewModel.selectedResult")?g("li",{key:`esri-search-result-renderer__list-item-${t}`},g("a",{class:B.anchor,href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.get("viewModel.view.popup");t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel&&this.viewModel.select(t)}_getSourceName(e,t){return t===le.ALL_INDEX?this.messages.all:e.name}};i([o(),Re("esri/widgets/Search/t9n/Search")],J.prototype,"messages",void 0),i([o()],J.prototype,"showMoreResultsOpen",void 0),i([o()],J.prototype,"viewModel",void 0),i([Ue()],J.prototype,"_showMoreResultsClick",null),i([Ue()],J.prototype,"_selectResultClick",null),J=i([N("esri.widgets.Search.SearchResultRenderer")],J);const er=J,tr=/<[a-z/][\s\S]*>/i;let f=class extends et{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new Xe,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new er,this._locateFailed=null,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=h.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new le,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=s=>{var n;const r=s.relatedTarget;r&&((n=this._container)!=null&&n.contains(r))||this._clearActiveMenu()},this.addHandles([de(()=>this.searchTerm,s=>{(s&&this.activeMenu==="warning"||!s&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()}),Nt(()=>{var s;return(s=this.viewModel)==null?void 0:s.allSources},"change",()=>this._watchSourceChanges()),de(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),$e),de(()=>{var s;return(s=this.viewModel)==null?void 0:s.defaultPopupTemplate},s=>{s&&(s.content=this._renderSearchResultsContent.bind(this))},$e)])}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){var e;(e=this._inputNode)==null||e.focus(),this.emit("search-focus")}blur(){var e;(e=this._inputNode)==null||e.blur(),this.emit("search-blur")}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:s}=t;return this._searchController=t,this.viewModel.search(e,{signal:s}).catch(r=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,r}).then(r=>{if(this._searchController===t)return this.activeMenu=r.numResults?"none":"warning",this._searchController=null,r})}suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:s}).then(r=>{if(this._suggestController===t)return this._suggestController=null,r.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),r}).catch(()=>{if(this._suggestController===t)return this._suggestController=null,null})}render(){const{state:e}=this.viewModel,t={[h.disabled]:e==="disabled",[h.esriWidgetDisabled]:this.disabled};return g("div",{class:this.classes(h.base,t)},e==="loading"?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e,disabled:t}=this;return g("button",{"aria-label":e.searchButtonTitle,bind:this,disabled:t,class:this.classes(h.submitButton,h.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},g("span",{"aria-hidden":"true",class:h.searchIcon}))}renderWarningMenu(){return g("div",{key:"esri-search__error-menu",class:this.classes(h.menu,h.warningMenu)},g("div",{class:h.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:s,sourceMenuButtonId:r,disabled:n}=this,{activeSourceIndex:l,allSources:a}=this.viewModel;return a.length>1?g("button",{id:r,key:"esri-search__source-menu-button",bind:this,disabled:n,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":(t==="source").toString(),"aria-controls":s,class:this.classes(h.sourcesButton,h.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:ve,"data-node-ref":"_sourceMenuButtonNode",type:"button"},g("span",{"aria-hidden":"true",class:h.dropdownIcon}),g("span",{"aria-hidden":"true",class:h.dropupIcon}),g("span",{class:h.sourceName},this._getSourceName(l))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:s,activeMenu:r,sourceMenuId:n,sourceMenuButtonId:l}=this,a=r==="source"&&s>-1?this._buildId("source-item",s):null;return e.length>1?g("ul",{"aria-activedescendant":a,"aria-labelledby":l,id:n,role:"menu",bind:this,afterCreate:ve,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:h.menuList,tabIndex:-1},t?this.renderSource(le.ALL_INDEX):null,e.map((u,c)=>this.renderSource(c)).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?g("div",{key:"esri-search__source-menu",class:this.classes(h.menu,h.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t,disabled:s}=this;return g("div",{class:h.loader,key:"base-loader",tabIndex:s?-1:null},g("span",{"aria-hidden":"true",class:h.loaderAnimation}),g("span",{class:h.fallbackText},e.searchButtonTitle),g("span",{class:h.loaderText},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:s}=this,r={[h.hasMultipleSources]:e.length>1,[h.isLoading]:t==="loading",[h.isSearching]:t==="searching",[h.showWarning]:s==="warning",[h.showSources]:s==="source",[h.showSuggestions]:s==="suggestion"};return g("div",{tabIndex:-1,afterCreate:n=>{this._container=n,n.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:n=>{n.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,h.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?g("button",{bind:this,disabled:this.disabled,class:this.classes(h.clearButton,h.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},g("span",{"aria-hidden":"true",class:h.clearIcon})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:s}=this,r=t&&!s,n=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return r?g("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(h.menuList,h.suggestionList,h.suggestionListCurrentLocation)},g("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),role:"option",class:this.classes(h.menuItem,n?h.menuItemFocus:null)},g("span",{"aria-hidden":"true",class:h.locate})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:s,messages:r,suggestionsMenuId:n,inputId:l,_activeMenuItemIndex:a,disabled:u}=this,{maxInputLength:c,placeholder:d,searchTerm:p,suggestionCount:_}=this.viewModel,v=!(!(t&&!s)&&!_),m=e==="suggestion"&&a>-1?this._buildId("suggestion-item",a):null;return g("input",{"aria-activedescendant":m,"aria-autocomplete":"list","aria-expanded":(v&&e==="suggestion").toString(),"aria-controls":v?n:null,"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,bind:this,disabled:u,placeholder:d,maxlength:c,autocomplete:"off",type:"text",class:this.classes(h.esriInput,h.input),value:p,id:l,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:ve,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:p?"":d})}renderForm(){return g("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:h.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,s=e.results.length,r=e.results;return s?g("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(h.menuList,h.suggestionList)},r.map(n=>this.renderSuggestion(n,this._menuItemCount++))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map(t=>[this.renderSuggestionHeader(t),this.renderSuggestList(t)]):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:s,inputId:r}=this,{suggestionCount:n}=this.viewModel,l=t&&!e||n;return this._menuItemCount=0,l?g("div",{id:s,key:"esri-search__suggestions-menu",class:this.classes(h.menu,h.suggestionsMenu),role:"listbox","aria-labelledby":r,bind:this,afterCreate:ve,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return g("div",{key:"esri-search__input-container",class:h.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:r}=e,n=e.results.length,l=t.length>1&&s===le.ALL_INDEX;return n&&l?g("div",{key:`esri-search__suggestion-header-${r}`,class:h.menuHeader},this._getSourceName(r)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:s,messages:r}=this,{searchTerm:n}=this.viewModel;if(n){const{text:l}=e,a=l||r.untitledResult,u=tr.test(a),c=[];if(u)c.push(g("div",{innerHTML:a}));else{const p=this._splitResult(a,n),_=n.toLowerCase();p.forEach((v,m)=>{v&&v.length&&(v.toLowerCase()===_?c.push(g("strong",{key:m},v)):c.push(v))})}const d=this.activeMenu==="suggestion"&&s===t;return g("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(h.menuItem,d?h.menuItemFocus:null)},c)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:s}=this.viewModel,r={[h.menuItemActive]:e===t,[h.menuItemFocus]:this.activeMenu==="source"&&e===(s?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},n=s?e+1:e;return g("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",n),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(h.source,h.menuItem,r)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,s=e?Ye(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return g("div",{key:"esri-search__no_results"},g("div",{class:h.warningMenuHeader},t.noResults),g("div",{class:h.warningMenuText},s))}renderEmptySearchWarning(){const{messages:e}=this;return g("div",{key:"esri-search__empty-search"},g("span",{"aria-hidden":"true",class:h.noticeIcon}),g("span",{class:h.noValueText},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return g("div",{key:"esri-search__locate-error"},g("span",{"aria-hidden":"true",class:h.noticeIcon}),g("span",{class:h.noValueText},e.locateError))}renderWarning(){var r;const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:s}=this;return t?this.renderLocateWarning():(r=s.selectedSuggestion)!=null&&r.location||e?this.renderNoResultsWarning(e):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${t===void 0?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,s="sources";e.remove(s),t.forEach(r=>e.add(de(()=>r.name,()=>this.scheduleRender()),s))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){var t;const e=this.activeMenu==="source";this.activeMenu=e?"none":"source",this.renderNow(),this.activeMenu==="source"&&((t=this._sourceListNode)==null||t.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).then(s=>{this.activeMenu=s.numResults?"none":"warning"}).catch(()=>{this._locateFailed=!0,this.activeMenu="warning"}).then(()=>{this._searchController=null})}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var s;if(!e)return;const t=e["data-source-index"];this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),(s=this._sourceMenuButtonNode)==null||s.focus()}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){var n;const t=Ie(e);if(e.ctrlKey||e.metaKey||t==="Copy"||t==="ArrowLeft"||t==="ArrowRight"||t==="Shift")return;if(t==="Tab"||t==="Escape"||e.shiftKey&&t==="Tab")return this._cancelSuggest(),void(t==="Escape"&&this._clearActiveMenu());const s=t==="Home"||t==="End"||t==="ArrowUp"||t==="ArrowDown";if(t==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=(n=this._suggestionListNode)==null?void 0:n.getElementsByTagName("li");if(r!=null&&r.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),s)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);const l=r[this._activeMenuItemIndex];if(t==="Enter"&&l){const a=l["data-suggestion"];return void(a?(this._focus(),this.search(a)):l["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,s){const r=this._activeMenuItemIndex;e==="Home"&&(this._activeMenuItemIndex=0),e==="End"&&(this._activeMenuItemIndex=t.length-1),e==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),e==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&At(t[this._activeMenuItemIndex],s)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=Ie(e);if(Pt(t)){e.preventDefault();const s=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(s)}else t!=="ArrowUp"&&t!=="ArrowDown"&&t!=="End"&&t!=="Home"||e.preventDefault()}_handleSourceMenuKeyup(e){var n,l;const t=Ie(e),s=t==="ArrowUp"||t==="ArrowDown"||t==="End"||t==="Home";if(s&&e.preventDefault(),t==="Escape")return this._clearActiveMenu(),void((n=this._sourceMenuButtonNode)==null?void 0:n.focus());const r=(l=this._sourceListNode)==null?void 0:l.getElementsByTagName("li");return r&&r.length!==0&&s?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(e){const{messages:t}=this,s=this.viewModel,{allSources:r}=s,n=r.getItemAt(e);return e===le.ALL_INDEX?t.all:n&&n.name||t.untitledSource}_splitResult(e,t){const s=jt(t);return e.replace(new RegExp(`(^|)(${s})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};i([o()],f.prototype,"_activeMenuItemIndex",void 0),i([o()],f.prototype,"displayedSearchTerm",null),i([o({readOnly:!0})],f.prototype,"inputId",null),i([o({readOnly:!0})],f.prototype,"suggestionsMenuId",null),i([o({readOnly:!0})],f.prototype,"sourceMenuId",null),i([o({readOnly:!0})],f.prototype,"sourceMenuButtonId",null),i([o()],f.prototype,"activeMenu",void 0),i([o({readOnly:!0})],f.prototype,"activeSource",null),i([o()],f.prototype,"activeSourceIndex",null),i([o()],f.prototype,"allPlaceholder",null),i([o({readOnly:!0})],f.prototype,"allSources",null),i([o()],f.prototype,"autoNavigate",null),i([o()],f.prototype,"autoSelect",null),i([o({readOnly:!0})],f.prototype,"defaultSources",null),i([o()],f.prototype,"disabled",void 0),i([o()],f.prototype,"goToOverride",null),i([o()],f.prototype,"iconClass",void 0),i([o()],f.prototype,"includeDefaultSources",null),i([o()],f.prototype,"label",null),i([o()],f.prototype,"locationEnabled",null),i([o()],f.prototype,"maxResults",null),i([o()],f.prototype,"maxSuggestions",null),i([o(),Re("esri/widgets/Search/t9n/Search")],f.prototype,"messages",void 0),i([o(),Re("esri/t9n/common")],f.prototype,"messagesCommon",void 0),i([o()],f.prototype,"minSuggestCharacters",null),i([o()],f.prototype,"popupEnabled",null),i([o()],f.prototype,"popupTemplate",null),i([o()],f.prototype,"portal",null),i([o()],f.prototype,"resultGraphic",null),i([o()],f.prototype,"resultGraphicEnabled",null),i([o({readOnly:!0})],f.prototype,"results",null),i([o()],f.prototype,"searchAllEnabled",null),i([o()],f.prototype,"searchTerm",null),i([o({readOnly:!0})],f.prototype,"selectedResult",null),i([o()],f.prototype,"sources",null),i([o({readOnly:!0})],f.prototype,"suggestions",null),i([o()],f.prototype,"suggestionsEnabled",null),i([o()],f.prototype,"view",null),i([rs(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),o({type:le})],f.prototype,"viewModel",void 0),f=i([N("esri.widgets.Search")],f);const fi=f;export{fi as default};
