import{e as o,a as m,v as g,y as r}from"./Accessor-815cb0cf.js";import{x as D}from"./Basemap-c8601fc5.js";import{_ as S}from"./preload-helper-fb43855a.js";import{l as C}from"./Color-5e799d63.js";import{j as H}from"./Collection-912f4315.js";import{n as W}from"./collectionUtils-5a99c1c0.js";import{o as b}from"./compilerUtils-024563a4.js";import{s as T,a as w}from"./Error-781981d1.js";import{l as $,u as B}from"./JSONSupport-2b897629.js";import{p as L}from"./string-75082bc6.js";import{m as F}from"./Loadable-6776e4d9.js";import{l as G}from"./loadAll-38268fb1.js";import{f as u,E as U}from"./promiseUtils-28f2a985.js";import{T as R,b as P}from"./ensureType-125d327f.js";import{r as V}from"./Extent-8fae2379.js";import{t as M}from"./typedArrayUtil-74bbfd45.js";import{o as x}from"./enumeration-94b1319d.js";import{r as Y,n as j}from"./opacityUtils-107b33de.js";import{l as v}from"./CollectionFlattener-670e79b4.js";import{n as X}from"./Evented-3dfb26f2.js";import{s as O}from"./cast-f7d2a22f.js";import{v as Z,w as J}from"./layerUtils-5e9bebc1.js";import{p as q,y as z,m as Q}from"./basemapUtils-7287d45c.js";import{l as k,d as K,t as tt}from"./TablesMixin-d42f2392.js";import"./watch-c7facfb0.js";import"./ArrayPool-ae2ef0ab.js";import"./nextTick-3ee5a785.js";import"./deprecate-da2b7904.js";import"./request-6e1d5843.js";import"./Portal-c7b19d88.js";import"./locale-30120714.js";import"./PortalGroup-d3a43002.js";import"./PortalUser-a3f3561a.js";import"./PortalItem-90bf2143.js";import"./assets-7bd3ffcf.js";import"./messages-dc0c80a1.js";import"./writeUtils-8884705e.js";import"./colorUtils-639f4d25.js";import"./mathUtils-15f63a45.js";import"./SimpleObservable-729c9019.js";import"./Promise-092442f7.js";import"./asyncUtils-5c97747c.js";import"./Layer-9c99e5a9.js";import"./geometry-0d19f94b.js";import"./Polyline-40b9e769.js";import"./typeUtils-3bf84b36.js";import"./Identifiable-f5397426.js";var c;let d=c=class extends ${constructor(t){super(t),this.type="none"}clone(){return new c({type:this.type})}};o([x({none:"none",stayAbove:"stay-above"})],d.prototype,"type",void 0),d=c=o([m("esri.ground.NavigationConstraint")],d);let i=class extends g{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};o([r()],i.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),o([r()],i.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),o([r()],i.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),o([r()],i.prototype,"DECONFLICTOR_SHOW_GRID",void 0),o([r()],i.prototype,"LABELS_SHOW_BORDER",void 0),o([r()],i.prototype,"TEXT_SHOW_BASELINE",void 0),o([r()],i.prototype,"TEXT_SHOW_BORDER",void 0),o([r()],i.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),o([r()],i.prototype,"OVERLAY_SHOW_CENTER",void 0),o([r()],i.prototype,"SHOW_POI",void 0),o([r()],i.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),o([r()],i.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),o([r()],i.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),o([r()],i.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),o([r()],i.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),o([r()],i.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),o([r()],i.prototype,"I3S_TREE_SHOW_TILES",void 0),o([r()],i.prototype,"I3S_SHOW_MODIFICATIONS",void 0),o([r()],i.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),o([r()],i.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),o([r()],i.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o([r()],i.prototype,"LINE_WIREFRAMES",void 0),o([r()],i.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),i=o([m("esri.views.3d.support.DebugFlags")],i);const et=new i;var h;let n=h=class extends B(F){constructor(t){super(t),this.opacity=1,this.shading=!et.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new H;const e=s=>{s.parent&&s.parent!==this&&"remove"in s.parent&&s.parent.remove(s),s.parent=this,s.type!=="elevation"&&s.type!=="base-elevation"&&T.getLogger(this.declaredClass).error(`Layer '${s.title}, id:${s.id}' of type '${s.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},a=s=>{s.parent=null};this.layers.on("after-add",s=>e(s.item)),this.layers.on("after-remove",s=>a(s.item))}initialize(){this.when().catch(t=>{T.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",W(t,this._get("layers")))}writeLayers(t,e,a,s){const p=[];t&&(s={...s,layerContainerType:"ground"},t.forEach(E=>{if("write"in E){const y={};b(E)().write(y,s)&&p.push(y)}else s&&s.messages&&s.messages.push(new w("layer:unsupported",`Layers (${E.title}, ${E.id}) of type '${E.declaredClass}' cannot be persisted in the ground`,{layer:E}))})),e.layers=p}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return G(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:a}=await S(()=>import("./ElevationQuery-5ac7e540.js"),["assets/ElevationQuery-5ac7e540.js","assets/asyncUtils-5c97747c.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/Extent-8fae2379.js","assets/JSONSupport-2b897629.js","assets/cast-f7d2a22f.js","assets/Polyline-40b9e769.js","assets/projection-6de68766.js","assets/preload-helper-fb43855a.js","assets/mathUtils-15f63a45.js","assets/SimpleObservable-729c9019.js","assets/mat4-a8da3f27.js","assets/assets-7bd3ffcf.js","assets/request-6e1d5843.js","assets/zscale-a617710a.js","assets/aaBoundingRect-3cd21eb0.js","assets/geometry-0d19f94b.js","assets/typeUtils-3bf84b36.js","assets/TileKey-b87e0dc5.js"]);u(e);const s=new a,p=this.layers.filter(f).toArray();return s.queryAll(p,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:a}=await S(()=>import("./ElevationQuery-5ac7e540.js"),["assets/ElevationQuery-5ac7e540.js","assets/asyncUtils-5c97747c.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/Extent-8fae2379.js","assets/JSONSupport-2b897629.js","assets/cast-f7d2a22f.js","assets/Polyline-40b9e769.js","assets/projection-6de68766.js","assets/preload-helper-fb43855a.js","assets/mathUtils-15f63a45.js","assets/SimpleObservable-729c9019.js","assets/mat4-a8da3f27.js","assets/assets-7bd3ffcf.js","assets/request-6e1d5843.js","assets/zscale-a617710a.js","assets/aaBoundingRect-3cd21eb0.js","assets/geometry-0d19f94b.js","assets/typeUtils-3bf84b36.js","assets/TileKey-b87e0dc5.js"]);u(e);const s=new a,p=this.layers.filter(f).toArray();return s.createSamplerAll(p,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:L(this.surfaceColor),navigationConstraint:L(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new h({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,a){const s=e&&e.origin||"web-scene",p=e&&e.portal||null,E=e&&e.url||null;return S(()=>import("./layersCreator-e8fd23d3.js"),["assets/layersCreator-e8fd23d3.js","assets/Collection-912f4315.js","assets/Accessor-815cb0cf.js","assets/typedArrayUtil-74bbfd45.js","assets/watch-c7facfb0.js","assets/ArrayPool-ae2ef0ab.js","assets/string-75082bc6.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-28f2a985.js","assets/Error-781981d1.js","assets/ensureType-125d327f.js","assets/Evented-3dfb26f2.js","assets/SimpleObservable-729c9019.js","assets/lazyLayerLoader-e1c05d81.js","assets/preload-helper-fb43855a.js","assets/PortalItem-90bf2143.js","assets/assets-7bd3ffcf.js","assets/request-6e1d5843.js","assets/JSONSupport-2b897629.js","assets/Loadable-6776e4d9.js","assets/Promise-092442f7.js","assets/Extent-8fae2379.js","assets/cast-f7d2a22f.js","assets/Portal-c7b19d88.js","assets/locale-30120714.js","assets/PortalGroup-d3a43002.js","assets/PortalUser-a3f3561a.js","assets/portalLayers-8ca3ee4e.js","assets/layerUtils-5e9bebc1.js","assets/layersLoader-b01dfabc.js","assets/Layer-9c99e5a9.js","assets/geometry-0d19f94b.js","assets/Polyline-40b9e769.js","assets/typeUtils-3bf84b36.js","assets/Identifiable-f5397426.js","assets/arcgisLayerUrl-94ca51fa.js","assets/persistableUrlUtils-0364346d.js","assets/fetchService-659cc3dd.js","assets/jsonContext-2d0e3b89.js","assets/portalItemUtils-2867876d.js","assets/projection-6de68766.js","assets/mathUtils-15f63a45.js","assets/mat4-a8da3f27.js","assets/zscale-a617710a.js","assets/styleUtils-023b7cfa.js","assets/asyncUtils-5c97747c.js"]).then(({populateOperationalLayers:y})=>{u(a);const I=[];if(t.layers&&Array.isArray(t.layers)){const N={context:{origin:s,url:E,portal:p,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};I.push(y(this.layers,t.layers,N))}return U(I)}).then(()=>{})}};function ot(t){return t&&"createElevationSampler"in t}function f(t){return t.type==="elevation"||ot(t)}o([r({json:{read:!1}})],n.prototype,"layers",null),o([V("layers")],n.prototype,"writeLayers",null),o([r({readOnly:!0})],n.prototype,"resourceInfo",void 0),o([r({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:R,read:{reader:Y,source:"transparency"},write:{writer:(t,e)=>{e.transparency=j(t)},target:"transparency"}}})],n.prototype,"opacity",void 0),o([r({type:Boolean,nonNullable:!0,json:{read:!1}})],n.prototype,"shading",void 0),o([r({type:C,json:{type:[R],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],n.prototype,"surfaceColor",void 0),o([r({type:d,json:{write:!0}})],n.prototype,"navigationConstraint",void 0),n=h=o([m("esri.Ground")],n);const _=n;function rt(t){var e,a;return!(!(t!=null&&t.loaded)||!((a=(e=Z(t))==null?void 0:e.operations)!=null&&a.supportsEditing)||"editingEnabled"in t&&!J(t))}const A={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function st(t){let e=null;if(typeof t=="string")if(t in A){const a=A[t];e=new _({resourceInfo:{data:{layers:[a]}}})}else T.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=P(_,t);return e}let l=class extends k(K(X.EventedMixin(g))){constructor(t){super(t),this.allLayers=new v({getCollections:()=>{var e,a,s;return[(e=this.basemap)==null?void 0:e.baseLayers,(a=this.ground)==null?void 0:a.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=tt(this),this.basemap=null,this.editableLayers=new v({getCollections:()=>[this.allLayers],itemFilterFunction:rt}),this.ground=new _,this._basemapCache=q()}destroy(){var t,e;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(t=this.ground)==null||t.destroy(),(e=this.basemap)==null||e.destroy(),z(this._basemapCache),this._basemapCache=null}castBasemap(t){return Q(t,this._basemapCache)}castGround(t){const e=st(t);return M(e)?this._get("ground"):e}findLayerById(t){return this.allLayers.find(e=>e.id===t)}findTableById(t){return this.allTables.find(e=>e.id===t)}};o([r({readOnly:!0,dependsOn:[]})],l.prototype,"allLayers",void 0),o([r({readOnly:!0})],l.prototype,"allTables",void 0),o([r({type:D})],l.prototype,"basemap",void 0),o([O("basemap")],l.prototype,"castBasemap",null),o([r({readOnly:!0})],l.prototype,"editableLayers",void 0),o([r({type:_,nonNullable:!0})],l.prototype,"ground",void 0),o([O("ground")],l.prototype,"castGround",null),l=o([m("esri.Map")],l);const kt=l;export{kt as default};
